{"ast":null,"code":"'use strict';\n\nvar _asyncToGenerator = require(\"E:/DW/wasai-cinema/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\n\nvar _objectSpread = require(\"E:/DW/wasai-cinema/node_modules/@babel/runtime/helpers/objectSpread2.js\").default;\n\nvar _createClass = require(\"E:/DW/wasai-cinema/node_modules/@babel/runtime/helpers/createClass.js\").default;\n\nvar _classCallCheck = require(\"E:/DW/wasai-cinema/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\n\nvar _inherits = require(\"E:/DW/wasai-cinema/node_modules/@babel/runtime/helpers/inherits.js\").default;\n\nvar _createSuper = require(\"E:/DW/wasai-cinema/node_modules/@babel/runtime/helpers/createSuper.js\").default;\n\nvar _wrapNativeSuper = require(\"E:/DW/wasai-cinema/node_modules/@babel/runtime/helpers/wrapNativeSuper.js\").default;\n\nrequire(\"regenerator-runtime/runtime.js\");\n\nrequire(\"core-js/modules/es.error.cause.js\");\n\nrequire(\"core-js/modules/es.function.name.js\");\n\nrequire(\"core-js/modules/es.array.includes.js\");\n\nrequire(\"core-js/modules/es.object.to-string.js\");\n\nvar retry = require('retry');\n\nvar networkErrorMsgs = ['Failed to fetch', // Chrome\n'NetworkError when attempting to fetch resource.', // Firefox\n'The Internet connection appears to be offline.', // Safari\n'Network request failed' // `cross-fetch`\n];\n\nvar AbortError = /*#__PURE__*/function (_Error) {\n  _inherits(AbortError, _Error);\n\n  var _super = _createSuper(AbortError);\n\n  function AbortError(message) {\n    var _this;\n\n    _classCallCheck(this, AbortError);\n\n    _this = _super.call(this);\n\n    if (message instanceof Error) {\n      _this.originalError = message;\n      var _message = message;\n      message = _message.message;\n    } else {\n      _this.originalError = new Error(message);\n      _this.originalError.stack = _this.stack;\n    }\n\n    _this.name = 'AbortError';\n    _this.message = message;\n    return _this;\n  }\n\n  return _createClass(AbortError);\n}( /*#__PURE__*/_wrapNativeSuper(Error));\n\nvar decorateErrorWithCounts = function decorateErrorWithCounts(error, attemptNumber, options) {\n  // Minus 1 from attemptNumber because the first attempt does not count as a retry\n  var retriesLeft = options.retries - (attemptNumber - 1);\n  error.attemptNumber = attemptNumber;\n  error.retriesLeft = retriesLeft;\n  return error;\n};\n\nvar isNetworkError = function isNetworkError(errorMessage) {\n  return networkErrorMsgs.includes(errorMessage);\n};\n\nvar pRetry = function pRetry(input, options) {\n  return new Promise(function (resolve, reject) {\n    options = _objectSpread({\n      onFailedAttempt: function onFailedAttempt() {},\n      retries: 10\n    }, options);\n    var operation = retry.operation(options);\n    operation.attempt( /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(attemptNumber) {\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                _context.t0 = resolve;\n                _context.next = 4;\n                return input(attemptNumber);\n\n              case 4:\n                _context.t1 = _context.sent;\n                (0, _context.t0)(_context.t1);\n                _context.next = 34;\n                break;\n\n              case 8:\n                _context.prev = 8;\n                _context.t2 = _context[\"catch\"](0);\n\n                if (_context.t2 instanceof Error) {\n                  _context.next = 13;\n                  break;\n                }\n\n                reject(new TypeError(\"Non-error was thrown: \\\"\".concat(_context.t2, \"\\\". You should only throw errors.\")));\n                return _context.abrupt(\"return\");\n\n              case 13:\n                if (!(_context.t2 instanceof AbortError)) {\n                  _context.next = 18;\n                  break;\n                }\n\n                operation.stop();\n                reject(_context.t2.originalError);\n                _context.next = 34;\n                break;\n\n              case 18:\n                if (!(_context.t2 instanceof TypeError && !isNetworkError(_context.t2.message))) {\n                  _context.next = 23;\n                  break;\n                }\n\n                operation.stop();\n                reject(_context.t2);\n                _context.next = 34;\n                break;\n\n              case 23:\n                decorateErrorWithCounts(_context.t2, attemptNumber, options);\n                _context.prev = 24;\n                _context.next = 27;\n                return options.onFailedAttempt(_context.t2);\n\n              case 27:\n                _context.next = 33;\n                break;\n\n              case 29:\n                _context.prev = 29;\n                _context.t3 = _context[\"catch\"](24);\n                reject(_context.t3);\n                return _context.abrupt(\"return\");\n\n              case 33:\n                if (!operation.retry(_context.t2)) {\n                  reject(operation.mainError());\n                }\n\n              case 34:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[0, 8], [24, 29]]);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n  });\n};\n\nmodule.exports = pRetry; // TODO: remove this in the next major version\n\nmodule.exports.default = pRetry;\nmodule.exports.AbortError = AbortError;","map":{"version":3,"sources":["E:/DW/wasai-cinema/node_modules/p-retry/index.js"],"names":["retry","require","networkErrorMsgs","AbortError","message","Error","originalError","stack","name","decorateErrorWithCounts","error","attemptNumber","options","retriesLeft","retries","isNetworkError","errorMessage","includes","pRetry","input","Promise","resolve","reject","onFailedAttempt","operation","attempt","TypeError","stop","mainError","module","exports","default"],"mappings":"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","sourcesContent":["'use strict';\nconst retry = require('retry');\n\nconst networkErrorMsgs = [\n\t'Failed to fetch', // Chrome\n\t'NetworkError when attempting to fetch resource.', // Firefox\n\t'The Internet connection appears to be offline.', // Safari\n\t'Network request failed' // `cross-fetch`\n];\n\nclass AbortError extends Error {\n\tconstructor(message) {\n\t\tsuper();\n\n\t\tif (message instanceof Error) {\n\t\t\tthis.originalError = message;\n\t\t\t({message} = message);\n\t\t} else {\n\t\t\tthis.originalError = new Error(message);\n\t\t\tthis.originalError.stack = this.stack;\n\t\t}\n\n\t\tthis.name = 'AbortError';\n\t\tthis.message = message;\n\t}\n}\n\nconst decorateErrorWithCounts = (error, attemptNumber, options) => {\n\t// Minus 1 from attemptNumber because the first attempt does not count as a retry\n\tconst retriesLeft = options.retries - (attemptNumber - 1);\n\n\terror.attemptNumber = attemptNumber;\n\terror.retriesLeft = retriesLeft;\n\treturn error;\n};\n\nconst isNetworkError = errorMessage => networkErrorMsgs.includes(errorMessage);\n\nconst pRetry = (input, options) => new Promise((resolve, reject) => {\n\toptions = {\n\t\tonFailedAttempt: () => {},\n\t\tretries: 10,\n\t\t...options\n\t};\n\n\tconst operation = retry.operation(options);\n\n\toperation.attempt(async attemptNumber => {\n\t\ttry {\n\t\t\tresolve(await input(attemptNumber));\n\t\t} catch (error) {\n\t\t\tif (!(error instanceof Error)) {\n\t\t\t\treject(new TypeError(`Non-error was thrown: \"${error}\". You should only throw errors.`));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (error instanceof AbortError) {\n\t\t\t\toperation.stop();\n\t\t\t\treject(error.originalError);\n\t\t\t} else if (error instanceof TypeError && !isNetworkError(error.message)) {\n\t\t\t\toperation.stop();\n\t\t\t\treject(error);\n\t\t\t} else {\n\t\t\t\tdecorateErrorWithCounts(error, attemptNumber, options);\n\n\t\t\t\ttry {\n\t\t\t\t\tawait options.onFailedAttempt(error);\n\t\t\t\t} catch (error) {\n\t\t\t\t\treject(error);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!operation.retry(error)) {\n\t\t\t\t\treject(operation.mainError());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n});\n\nmodule.exports = pRetry;\n// TODO: remove this in the next major version\nmodule.exports.default = pRetry;\n\nmodule.exports.AbortError = AbortError;\n"]},"metadata":{},"sourceType":"script"}