{"ast":null,"code":"\"use strict\";\n\nvar _toConsumableArray = require(\"E:/DW/wasai-cinema/node_modules/@babel/runtime/helpers/toConsumableArray.js\").default;\n\nvar _taggedTemplateLiteral = require(\"E:/DW/wasai-cinema/node_modules/@babel/runtime/helpers/taggedTemplateLiteral.js\").default;\n\nvar _templateObject, _templateObject2, _templateObject3, _templateObject4, _templateObject5;\n\nrequire(\"core-js/modules/es.error.cause.js\");\n\nrequire(\"core-js/modules/es.array.concat.js\");\n\nrequire(\"core-js/modules/es.object.to-string.js\");\n\nrequire(\"core-js/modules/es.set.js\");\n\nrequire(\"core-js/modules/es.string.iterator.js\");\n\nrequire(\"core-js/modules/web.dom-collections.iterator.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.extendSubschemaMode = exports.extendSubschemaData = exports.getSubschema = void 0;\n\nvar codegen_1 = require(\"../codegen\");\n\nvar util_1 = require(\"../util\");\n\nfunction getSubschema(it, _ref) {\n  var keyword = _ref.keyword,\n      schemaProp = _ref.schemaProp,\n      schema = _ref.schema,\n      schemaPath = _ref.schemaPath,\n      errSchemaPath = _ref.errSchemaPath,\n      topSchemaRef = _ref.topSchemaRef;\n\n  if (keyword !== undefined && schema !== undefined) {\n    throw new Error('both \"keyword\" and \"schema\" passed, only one allowed');\n  }\n\n  if (keyword !== undefined) {\n    var sch = it.schema[keyword];\n    return schemaProp === undefined ? {\n      schema: sch,\n      schemaPath: (0, codegen_1._)(_templateObject || (_templateObject = _taggedTemplateLiteral([\"\", \"\", \"\"])), it.schemaPath, (0, codegen_1.getProperty)(keyword)),\n      errSchemaPath: \"\".concat(it.errSchemaPath, \"/\").concat(keyword)\n    } : {\n      schema: sch[schemaProp],\n      schemaPath: (0, codegen_1._)(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"\", \"\", \"\", \"\"])), it.schemaPath, (0, codegen_1.getProperty)(keyword), (0, codegen_1.getProperty)(schemaProp)),\n      errSchemaPath: \"\".concat(it.errSchemaPath, \"/\").concat(keyword, \"/\").concat((0, util_1.escapeFragment)(schemaProp))\n    };\n  }\n\n  if (schema !== undefined) {\n    if (schemaPath === undefined || errSchemaPath === undefined || topSchemaRef === undefined) {\n      throw new Error('\"schemaPath\", \"errSchemaPath\" and \"topSchemaRef\" are required with \"schema\"');\n    }\n\n    return {\n      schema: schema,\n      schemaPath: schemaPath,\n      topSchemaRef: topSchemaRef,\n      errSchemaPath: errSchemaPath\n    };\n  }\n\n  throw new Error('either \"keyword\" or \"schema\" must be passed');\n}\n\nexports.getSubschema = getSubschema;\n\nfunction extendSubschemaData(subschema, it, _ref2) {\n  var dataProp = _ref2.dataProp,\n      dpType = _ref2.dataPropType,\n      data = _ref2.data,\n      dataTypes = _ref2.dataTypes,\n      propertyName = _ref2.propertyName;\n\n  if (data !== undefined && dataProp !== undefined) {\n    throw new Error('both \"data\" and \"dataProp\" passed, only one allowed');\n  }\n\n  var gen = it.gen;\n\n  if (dataProp !== undefined) {\n    var errorPath = it.errorPath,\n        dataPathArr = it.dataPathArr,\n        opts = it.opts;\n    var nextData = gen.let(\"data\", (0, codegen_1._)(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"\", \"\", \"\"])), it.data, (0, codegen_1.getProperty)(dataProp)), true);\n    dataContextProps(nextData);\n    subschema.errorPath = (0, codegen_1.str)(_templateObject4 || (_templateObject4 = _taggedTemplateLiteral([\"\", \"\", \"\"])), errorPath, (0, util_1.getErrorPath)(dataProp, dpType, opts.jsPropertySyntax));\n    subschema.parentDataProperty = (0, codegen_1._)(_templateObject5 || (_templateObject5 = _taggedTemplateLiteral([\"\", \"\"])), dataProp);\n    subschema.dataPathArr = [].concat(_toConsumableArray(dataPathArr), [subschema.parentDataProperty]);\n  }\n\n  if (data !== undefined) {\n    var _nextData2 = data instanceof codegen_1.Name ? data : gen.let(\"data\", data, true); // replaceable if used once?\n\n\n    dataContextProps(_nextData2);\n    if (propertyName !== undefined) subschema.propertyName = propertyName; // TODO something is possibly wrong here with not changing parentDataProperty and not appending dataPathArr\n  }\n\n  if (dataTypes) subschema.dataTypes = dataTypes;\n\n  function dataContextProps(_nextData) {\n    subschema.data = _nextData;\n    subschema.dataLevel = it.dataLevel + 1;\n    subschema.dataTypes = [];\n    it.definedProperties = new Set();\n    subschema.parentData = it.data;\n    subschema.dataNames = [].concat(_toConsumableArray(it.dataNames), [_nextData]);\n  }\n}\n\nexports.extendSubschemaData = extendSubschemaData;\n\nfunction extendSubschemaMode(subschema, _ref3) {\n  var jtdDiscriminator = _ref3.jtdDiscriminator,\n      jtdMetadata = _ref3.jtdMetadata,\n      compositeRule = _ref3.compositeRule,\n      createErrors = _ref3.createErrors,\n      allErrors = _ref3.allErrors;\n  if (compositeRule !== undefined) subschema.compositeRule = compositeRule;\n  if (createErrors !== undefined) subschema.createErrors = createErrors;\n  if (allErrors !== undefined) subschema.allErrors = allErrors;\n  subschema.jtdDiscriminator = jtdDiscriminator; // not inherited\n\n  subschema.jtdMetadata = jtdMetadata; // not inherited\n}\n\nexports.extendSubschemaMode = extendSubschemaMode;","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAEA;;AACA;;AA6CA,SAAgBA,YAAhB,CACEC,EADF,QAEuF;AAAA,MAApFC,OAAoF,QAApFA,OAAoF;AAAA,MAA3EC,UAA2E,QAA3EA,UAA2E;AAAA,MAA/DC,MAA+D,QAA/DA,MAA+D;AAAA,MAAvDC,UAAuD,QAAvDA,UAAuD;AAAA,MAA3CC,aAA2C,QAA3CA,aAA2C;AAAA,MAA5BC,YAA4B,QAA5BA,YAA4B;;AAErF,MAAIL,OAAO,KAAKM,SAAZ,IAAyBJ,MAAM,KAAKI,SAAxC,EAAmD;AACjD,UAAM,IAAIC,KAAJ,CAAU,sDAAV,CAAN;AACD;;AAED,MAAIP,OAAO,KAAKM,SAAhB,EAA2B;AACzB,QAAME,GAAG,GAAGT,EAAE,CAACG,MAAH,CAAUF,OAAV,CAAZ;AACA,WAAOC,UAAU,KAAKK,SAAf,GACH;AACEJ,YAAM,EAAEM,GADV;AAEEL,gBAAU,GAAE,cAAF,+EAAMJ,EAAE,CAACI,UAAT,EAAsB,2BAAYH,OAAZ,CAAtB,CAFZ;AAGEI,mBAAa,YAAKL,EAAE,CAACK,aAAR,cAAyBJ,OAAzB;AAHf,KADG,GAMH;AACEE,YAAM,EAAEM,GAAG,CAACP,UAAD,CADb;AAEEE,gBAAU,GAAE,cAAF,qFAAMJ,EAAE,CAACI,UAAT,EAAsB,2BAAYH,OAAZ,CAAtB,EAA6C,2BAAYC,UAAZ,CAA7C,CAFZ;AAGEG,mBAAa,YAAKL,EAAE,CAACK,aAAR,cAAyBJ,OAAzB,cAAoC,2BAAeC,UAAf,CAApC;AAHf,KANJ;AAWD;;AAED,MAAIC,MAAM,KAAKI,SAAf,EAA0B;AACxB,QAAIH,UAAU,KAAKG,SAAf,IAA4BF,aAAa,KAAKE,SAA9C,IAA2DD,YAAY,KAAKC,SAAhF,EAA2F;AACzF,YAAM,IAAIC,KAAJ,CAAU,6EAAV,CAAN;AACD;;AACD,WAAO;AACLL,YAAM,EAANA,MADK;AAELC,gBAAU,EAAVA,UAFK;AAGLE,kBAAY,EAAZA,YAHK;AAILD,mBAAa,EAAbA;AAJK,KAAP;AAMD;;AAED,QAAM,IAAIG,KAAJ,CAAU,6CAAV,CAAN;AACD;;AApCDE;;AAsCA,SAAgBC,mBAAhB,CACEC,SADF,EAEEZ,EAFF,SAGgF;AAAA,MAA7Ea,QAA6E,SAA7EA,QAA6E;AAAA,MAArDC,MAAqD,SAAnEC,YAAmE;AAAA,MAA7CC,IAA6C,SAA7CA,IAA6C;AAAA,MAAvCC,SAAuC,SAAvCA,SAAuC;AAAA,MAA5BC,YAA4B,SAA5BA,YAA4B;;AAE9E,MAAIF,IAAI,KAAKT,SAAT,IAAsBM,QAAQ,KAAKN,SAAvC,EAAkD;AAChD,UAAM,IAAIC,KAAJ,CAAU,qDAAV,CAAN;AACD;;AAED,MAAOW,GAAP,GAAcnB,EAAd,CAAOmB,GAAP;;AAEA,MAAIN,QAAQ,KAAKN,SAAjB,EAA4B;AAC1B,QAAOa,SAAP,GAAuCpB,EAAvC,CAAOoB,SAAP;AAAA,QAAkBC,WAAlB,GAAuCrB,EAAvC,CAAkBqB,WAAlB;AAAA,QAA+BC,IAA/B,GAAuCtB,EAAvC,CAA+BsB,IAA/B;AACA,QAAMC,QAAQ,GAAGJ,GAAG,CAACK,GAAJ,CAAQ,MAAR,GAAgB,cAAhB,iFAAoBxB,EAAE,CAACgB,IAAvB,EAA8B,2BAAYH,QAAZ,CAA9B,GAAuD,IAAvD,CAAjB;AACAY,oBAAgB,CAACF,QAAD,CAAhB;AACAX,aAAS,CAACQ,SAAV,IAAsB,gBAAtB,iFAA4BA,SAA5B,EAAwC,yBAAaP,QAAb,EAAuBC,MAAvB,EAA+BQ,IAAI,CAACI,gBAApC,CAAxC;AACAd,aAAS,CAACe,kBAAV,IAA+B,cAA/B,6EAAmCd,QAAnC;AACAD,aAAS,CAACS,WAAV,gCAA4BA,WAA5B,IAAyCT,SAAS,CAACe,kBAAnD;AACD;;AAED,MAAIX,IAAI,KAAKT,SAAb,EAAwB;AACtB,QAAMgB,UAAQ,GAAGP,IAAI,YAAYY,cAAhB,GAAuBZ,IAAvB,GAA8BG,GAAG,CAACK,GAAJ,CAAQ,MAAR,EAAgBR,IAAhB,EAAsB,IAAtB,CAA/C,CADsB,CACqD;;;AAC3ES,oBAAgB,CAACF,UAAD,CAAhB;AACA,QAAIL,YAAY,KAAKX,SAArB,EAAgCK,SAAS,CAACM,YAAV,GAAyBA,YAAzB,CAHV,CAItB;AACD;;AAED,MAAID,SAAJ,EAAeL,SAAS,CAACK,SAAV,GAAsBA,SAAtB;;AAEf,WAASQ,gBAAT,CAA0BI,SAA1B,EAAyC;AACvCjB,aAAS,CAACI,IAAV,GAAiBa,SAAjB;AACAjB,aAAS,CAACkB,SAAV,GAAsB9B,EAAE,CAAC8B,SAAH,GAAe,CAArC;AACAlB,aAAS,CAACK,SAAV,GAAsB,EAAtB;AACAjB,MAAE,CAAC+B,iBAAH,GAAuB,IAAIC,GAAJ,EAAvB;AACApB,aAAS,CAACqB,UAAV,GAAuBjC,EAAE,CAACgB,IAA1B;AACAJ,aAAS,CAACsB,SAAV,gCAA0BlC,EAAE,CAACkC,SAA7B,IAAwCL,SAAxC;AACD;AACF;;AArCDnB;;AAuCA,SAAgByB,mBAAhB,CACEvB,SADF,SAEwF;AAAA,MAArFwB,gBAAqF,SAArFA,gBAAqF;AAAA,MAAnEC,WAAmE,SAAnEA,WAAmE;AAAA,MAAtDC,aAAsD,SAAtDA,aAAsD;AAAA,MAAvCC,YAAuC,SAAvCA,YAAuC;AAAA,MAAzBC,SAAyB,SAAzBA,SAAyB;AAEtF,MAAIF,aAAa,KAAK/B,SAAtB,EAAiCK,SAAS,CAAC0B,aAAV,GAA0BA,aAA1B;AACjC,MAAIC,YAAY,KAAKhC,SAArB,EAAgCK,SAAS,CAAC2B,YAAV,GAAyBA,YAAzB;AAChC,MAAIC,SAAS,KAAKjC,SAAlB,EAA6BK,SAAS,CAAC4B,SAAV,GAAsBA,SAAtB;AAC7B5B,WAAS,CAACwB,gBAAV,GAA6BA,gBAA7B,CALsF,CAKxC;;AAC9CxB,WAAS,CAACyB,WAAV,GAAwBA,WAAxB,CANsF,CAMlD;AACrC;;AATD3B","names":["getSubschema","it","keyword","schemaProp","schema","schemaPath","errSchemaPath","topSchemaRef","undefined","Error","sch","exports","extendSubschemaData","subschema","dataProp","dpType","dataPropType","data","dataTypes","propertyName","gen","errorPath","dataPathArr","opts","nextData","let","dataContextProps","jsPropertySyntax","parentDataProperty","codegen_1","_nextData","dataLevel","definedProperties","Set","parentData","dataNames","extendSubschemaMode","jtdDiscriminator","jtdMetadata","compositeRule","createErrors","allErrors"],"sourceRoot":"","sources":["../../../lib/compile/validate/subschema.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}