{"ast":null,"code":"\"use strict\";\n\nvar _slicedToArray = require(\"E:/DW/wasai-cinema/node_modules/@babel/runtime/helpers/slicedToArray.js\").default;\n\nvar _asyncToGenerator = require(\"E:/DW/wasai-cinema/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\n\nrequire(\"regenerator-runtime/runtime.js\");\n\nrequire(\"core-js/modules/es.object.entries.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getTarget = void 0;\n\nvar isPlainObj = require(\"is-plain-obj\");\n\nvar logger_1 = require(\"./logger\");\n\nvar logger = (0, logger_1.getInstance)();\n\nfunction getTarget(_x, _x2) {\n  return _getTarget.apply(this, arguments);\n}\n\nfunction _getTarget() {\n  _getTarget = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(req, config) {\n    var newTarget, router;\n    return regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            router = config.router;\n\n            if (!isPlainObj(router)) {\n              _context.next = 5;\n              break;\n            }\n\n            newTarget = getTargetFromProxyTable(req, router);\n            _context.next = 9;\n            break;\n\n          case 5:\n            if (!(typeof router === 'function')) {\n              _context.next = 9;\n              break;\n            }\n\n            _context.next = 8;\n            return router(req);\n\n          case 8:\n            newTarget = _context.sent;\n\n          case 9:\n            return _context.abrupt(\"return\", newTarget);\n\n          case 10:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n  return _getTarget.apply(this, arguments);\n}\n\nexports.getTarget = getTarget;\n\nfunction getTargetFromProxyTable(req, table) {\n  var result;\n  var host = req.headers.host;\n  var path = req.url;\n  var hostAndPath = host + path;\n\n  for (var _i = 0, _Object$entries = Object.entries(table); _i < _Object$entries.length; _i++) {\n    var _Object$entries$_i = _slicedToArray(_Object$entries[_i], 1),\n        key = _Object$entries$_i[0];\n\n    if (containsPath(key)) {\n      if (hostAndPath.indexOf(key) > -1) {\n        // match 'localhost:3000/api'\n        result = table[key];\n        logger.debug('[HPM] Router table match: \"%s\"', key);\n        break;\n      }\n    } else {\n      if (key === host) {\n        // match 'localhost:3000'\n        result = table[key];\n        logger.debug('[HPM] Router table match: \"%s\"', host);\n        break;\n      }\n    }\n  }\n\n  return result;\n}\n\nfunction containsPath(v) {\n  return v.indexOf('/') > -1;\n}","map":{"version":3,"sources":["E:/DW/wasai-cinema/node_modules/http-proxy-middleware/dist/router.js"],"names":["Object","defineProperty","exports","value","getTarget","isPlainObj","require","logger_1","logger","getInstance","req","config","router","newTarget","getTargetFromProxyTable","table","result","host","headers","path","url","hostAndPath","entries","key","containsPath","indexOf","debug","v"],"mappings":"AAAA;;;;;;;;;;AACAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAAEC,EAAAA,KAAK,EAAE;AAAT,CAA7C;AACAD,OAAO,CAACE,SAAR,GAAoB,KAAK,CAAzB;;AACA,IAAMC,UAAU,GAAGC,OAAO,CAAC,cAAD,CAA1B;;AACA,IAAMC,QAAQ,GAAGD,OAAO,CAAC,UAAD,CAAxB;;AACA,IAAME,MAAM,GAAG,CAAC,GAAGD,QAAQ,CAACE,WAAb,GAAf;;SACeL,S;;;;;uEAAf,iBAAyBM,GAAzB,EAA8BC,MAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAEUC,YAAAA,MAFV,GAEmBD,MAAM,CAACC,MAF1B;;AAAA,iBAGQP,UAAU,CAACO,MAAD,CAHlB;AAAA;AAAA;AAAA;;AAIQC,YAAAA,SAAS,GAAGC,uBAAuB,CAACJ,GAAD,EAAME,MAAN,CAAnC;AAJR;AAAA;;AAAA;AAAA,kBAMa,OAAOA,MAAP,KAAkB,UAN/B;AAAA;AAAA;AAAA;;AAAA;AAAA,mBAO0BA,MAAM,CAACF,GAAD,CAPhC;;AAAA;AAOQG,YAAAA,SAPR;;AAAA;AAAA,6CASWA,SATX;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;AAWAX,OAAO,CAACE,SAAR,GAAoBA,SAApB;;AACA,SAASU,uBAAT,CAAiCJ,GAAjC,EAAsCK,KAAtC,EAA6C;AACzC,MAAIC,MAAJ;AACA,MAAMC,IAAI,GAAGP,GAAG,CAACQ,OAAJ,CAAYD,IAAzB;AACA,MAAME,IAAI,GAAGT,GAAG,CAACU,GAAjB;AACA,MAAMC,WAAW,GAAGJ,IAAI,GAAGE,IAA3B;;AACA,qCAAoBnB,MAAM,CAACsB,OAAP,CAAeP,KAAf,CAApB,qCAA2C;AAAtC;AAAA,QAAOQ,GAAP;;AACD,QAAIC,YAAY,CAACD,GAAD,CAAhB,EAAuB;AACnB,UAAIF,WAAW,CAACI,OAAZ,CAAoBF,GAApB,IAA2B,CAAC,CAAhC,EAAmC;AAC/B;AACAP,QAAAA,MAAM,GAAGD,KAAK,CAACQ,GAAD,CAAd;AACAf,QAAAA,MAAM,CAACkB,KAAP,CAAa,gCAAb,EAA+CH,GAA/C;AACA;AACH;AACJ,KAPD,MAQK;AACD,UAAIA,GAAG,KAAKN,IAAZ,EAAkB;AACd;AACAD,QAAAA,MAAM,GAAGD,KAAK,CAACQ,GAAD,CAAd;AACAf,QAAAA,MAAM,CAACkB,KAAP,CAAa,gCAAb,EAA+CT,IAA/C;AACA;AACH;AACJ;AACJ;;AACD,SAAOD,MAAP;AACH;;AACD,SAASQ,YAAT,CAAsBG,CAAtB,EAAyB;AACrB,SAAOA,CAAC,CAACF,OAAF,CAAU,GAAV,IAAiB,CAAC,CAAzB;AACH","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getTarget = void 0;\nconst isPlainObj = require(\"is-plain-obj\");\nconst logger_1 = require(\"./logger\");\nconst logger = (0, logger_1.getInstance)();\nasync function getTarget(req, config) {\n    let newTarget;\n    const router = config.router;\n    if (isPlainObj(router)) {\n        newTarget = getTargetFromProxyTable(req, router);\n    }\n    else if (typeof router === 'function') {\n        newTarget = await router(req);\n    }\n    return newTarget;\n}\nexports.getTarget = getTarget;\nfunction getTargetFromProxyTable(req, table) {\n    let result;\n    const host = req.headers.host;\n    const path = req.url;\n    const hostAndPath = host + path;\n    for (const [key] of Object.entries(table)) {\n        if (containsPath(key)) {\n            if (hostAndPath.indexOf(key) > -1) {\n                // match 'localhost:3000/api'\n                result = table[key];\n                logger.debug('[HPM] Router table match: \"%s\"', key);\n                break;\n            }\n        }\n        else {\n            if (key === host) {\n                // match 'localhost:3000'\n                result = table[key];\n                logger.debug('[HPM] Router table match: \"%s\"', host);\n                break;\n            }\n        }\n    }\n    return result;\n}\nfunction containsPath(v) {\n    return v.indexOf('/') > -1;\n}\n"]},"metadata":{},"sourceType":"script"}