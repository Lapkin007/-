{"ast":null,"code":"import \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.regexp.test.js\";\nimport \"core-js/modules/es.array.splice.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { QueryFilmDetailArrangement, QueryFilmSeat as _QueryFilmSeat, PostToCart } from \"@/api/film\";\nexport default {\n  data: function data() {\n    return {\n      //座位样式\n      op_seat: require(\"../assets/img/seat3.png\"),\n      //验证手机号用\n      isPassTel: true,\n      // 包含座位的数量和已经选择的座位ID\n      film_anpai_info: {\n        select_seat: [],\n        //总座位\n        seatnum: 0,\n        // 售出电影票信息保存\n        saledseat: []\n      },\n      //手机号\n      phoneNumber: \"\",\n      //由座位数量生成包含 座位ID 座位的图片 的数组\n      film_anpai: [],\n      //座位样式\n      empty_seat: require(\"../assets/img/seat3.png\"),\n      buy_seat: require(\"../assets/img/seat2.png\"),\n      sale_seat: require(\"../assets/img/seat1.png\"),\n      //  用户选中的多个座位\n      selectdSeat: [],\n      //路由传参ID\n      Arrangement_id: this.$route.query.id,\n      //查询排片的电影详情传入的数组\n      movie_info: {\n        arrangement: {\n          id: \"\",\n          fid: \"\",\n          name: \"\",\n          seatNumber: 0,\n          price: 0,\n          type: \"\",\n          date: \"\",\n          startTime: \"\",\n          boxOffice: 0,\n          endTime: \"\",\n          founder: \"\",\n          createAt: \"\"\n        },\n        film: {\n          id: \"\",\n          name: \"\",\n          releaseTime: \"\",\n          type: \"\",\n          status: true,\n          region: \"\",\n          introduction: \"\",\n          hot: 13,\n          cover: \"\",\n          duration: 0,\n          isDelete: \"\"\n        }\n      }\n    };\n  },\n  methods: {\n    //手机号输入框的失去焦点时间\n    checkTel: function checkTel() {\n      var TelReg = /^1[3|4|5|7|8][0-9]\\d{8}$/;\n\n      if (TelReg.test(this.phoneNumber)) {\n        this.isPassTel = true;\n      } else {\n        this.isPassTel = false;\n        this.$message.error(\"请输入正确格式的手机号码\");\n      }\n\n      console.log(this.isPassTel);\n    },\n    //调用POST接口加入购物车和订单,加入购物车的按钮\n    AddtoCart: function AddtoCart() {\n      var _this = this;\n\n      if (this.phoneNumber == null || this.selectdSeat.length == 0 || this.phoneNumber == \"\" || this.isPassTel == false) {\n        this.$message.error(\"请正确填写电话或者选择至少一个座位\");\n      } else {\n        var vo = {\n          uid: parseInt(localStorage.getItem(\"uid\")),\n          aid: parseInt(this.Arrangement_id),\n          phone: this.phoneNumber,\n          seats: this.selectdSeat,\n          price: this.movie_info.arrangement.price\n        };\n        console.log(vo);\n        PostToCart(vo).then(function (res) {\n          if (res.code == 200) {\n            if (res.data.success == \"success\") {\n              _this.$message({\n                message: res.data.msg,\n                type: \"success\"\n              });\n\n              window.location.href = \"#/personal_center\";\n            } else {\n              _this.$message({\n                message: res.data.msg,\n                type: \"warning\"\n              });\n            }\n          } else {\n            _this.$message.error(\"fail\");\n          }\n        });\n      }\n    },\n    //调用查询排片的电影详情接口方法\n    QueryFilmInfo: function QueryFilmInfo() {\n      var _this2 = this;\n\n      QueryFilmDetailArrangement(this.Arrangement_id).then(function (res) {\n        if (res.code == 200) {\n          if (res.data.arrangement.id == _this2.Arrangement_id) {\n            _this2.movie_info = res.data;\n          }\n\n          ;\n          _this2.film_anpai_info.seatnum = _this2.movie_info.arrangement.seatNumber;\n        }\n      });\n    },\n    //调用查询排片的电影座位接口方法\n    QueryFilmSeat: function QueryFilmSeat() {\n      var _this3 = this;\n\n      _QueryFilmSeat(this.Arrangement_id).then(function (res) {\n        if (res.code == 200) {\n          _this3.film_anpai_info.saledseat = res.data;\n          console.log(_this3.film_anpai_info.saledseat);\n        }\n      });\n    },\n    //点击座位触发的方法 包含显示已选座位的方法\n    clickseat: function clickseat(seatnum) {\n      if (this.film_anpai[seatnum].seatimg == this.sale_seat) {\n        alert(\"座位已售出,请选择别的座位\");\n      } else if (this.film_anpai[seatnum].seatimg == this.empty_seat) {\n        this.film_anpai[seatnum].seatimg = this.buy_seat;\n        this.selectdSeat.push(seatnum + 1);\n      } else if (this.film_anpai[seatnum].seatimg == this.buy_seat) {\n        this.film_anpai[seatnum].seatimg = this.empty_seat;\n\n        for (var i = 0; i < this.selectdSeat.length; i++) {\n          if (this.selectdSeat[i] == seatnum + 1) {\n            this.selectdSeat.splice(i, 1);\n          }\n        }\n      }\n    }\n  },\n  computed: {\n    //生成总价格价格\n    totalprice: function totalprice() {\n      return this.movie_info.arrangement.price * this.selectdSeat.length;\n    },\n    //用来生成一个新的座位表,由座位数量生成包含 座位ID 座位的图片 的数组\n    SelectSeat: function SelectSeat() {\n      this.film_anpai = undefined;\n      this.film_anpai = new Array();\n\n      for (var i = 0; i < this.film_anpai_info.seatnum; i++) {\n        this.film_anpai.push({\n          seat_id: i,\n          seatimg: this.empty_seat\n        });\n      }\n\n      for (var j = 0; j < this.film_anpai_info.saledseat.length; j++) {\n        this.film_anpai[this.film_anpai_info.saledseat[j] - 1].seatimg = this.sale_seat;\n      }\n\n      return this.film_anpai;\n    }\n  },\n  mounted: function mounted() {\n    //调用查询电影详情接口方法\n    this.QueryFilmInfo(); //调用查询电影已选座位接口方法\n\n    this.QueryFilmSeat();\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkEA;AAEA;AACAA,MADA,kBACA;AACA;AACA;AACAC,iDAFA;AAGA;AACAC,qBAJA;AAKA;AACAC;AACAC,uBADA;AAEA;AACAC,kBAHA;AAIA;AACAC;AALA,OANA;AAaA;AACAC,qBAdA;AAeA;AACAC,oBAhBA;AAiBA;AACAC,oDAlBA;AAmBAC,kDAnBA;AAoBAC,mDApBA;AAqBA;AACAC,qBAtBA;AAuBA;AACAC,0CAxBA;AAyBA;AACAC;AACAC;AACAC,gBADA;AAEAC,iBAFA;AAGAC,kBAHA;AAIAC,uBAJA;AAKAC,kBALA;AAMAC,kBANA;AAOAC,kBAPA;AAQAC,uBARA;AASAC,sBATA;AAUAC,qBAVA;AAWAC,qBAXA;AAYAC;AAZA,SADA;AAeAC;AACAZ,gBADA;AAEAE,kBAFA;AAGAW,yBAHA;AAIAR,kBAJA;AAKAS,sBALA;AAMAC,oBANA;AAOAC,0BAPA;AAQAC,iBARA;AASAC,mBATA;AAUAC,qBAVA;AAWAC;AAXA;AAfA;AA1BA;AAwDA,GA1DA;AA2DAC;AACA;AACAC,YAFA,sBAEA;AACA;;AACA;AACA;AACA,OAFA,MAEA;AACA;AACA;AACA;;AACAC;AACA,KAXA;AAYA;AACAC,aAbA,uBAaA;AAAA;;AACA,yHACA;AAAA;AAAA,OADA,MAEA;AACA;AACAC,oDADA;AAEAC,4CAFA;AAGAC,iCAHA;AAIAC,iCAJA;AAKAxB;AALA;AAOAmB;AACAM;AACA;AACA;AACA;AAAAC;AAAAzB;AAAA;;AAEA0B;AACA,aAJA,MAKA;AACA;AAAAD;AAAAzB;AAAA;AACA;AACA,WATA,MAUA;AAAA;AAAA;AACA,SAZA;AAcA;AACA,KAxCA;AAyCA;AACA2B,iBA1CA,2BA0CA;AAAA;;AACAC;AACA;AACA,gEACA;AACA;AACA;;AAAA;AACA;AAEA;AACA,OATA;AAUA,KArDA;AAuDA;AACAC,iBAxDA,2BAwDA;AAAA;;AACAA;AACA;AAEA;AACAX;AACA;AACA,OANA;AAOA,KAhEA;AAkEA;AACAY,aAnEA,qBAmEA9C,OAnEA,EAmEA;AACA;AACA+C;AACA,OAFA,MAGA,yDACA;AACA;AACA;AACA,OAJA,MAKA,uDACA;AACA;;AACA,0DACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AApFA,GA3DA;AAiJAC;AACA;AACAC;AAAA;AAAA,KAFA;AAGA;AACAC;AACA;AACA;;AACA,6DACA;AAEA;AAAAC;AAAAC;AAAA;AAEA;;AACA,sEACA;AAEA;AACA;;AACA;AACA;AAnBA,GAjJA;AAsKAC;AACA;AACA,yBAFA,CAGA;;AACA;AACA;AA3KA","names":["data","op_seat","isPassTel","film_anpai_info","select_seat","seatnum","saledseat","phoneNumber","film_anpai","empty_seat","buy_seat","sale_seat","selectdSeat","Arrangement_id","movie_info","arrangement","id","fid","name","seatNumber","price","type","date","startTime","boxOffice","endTime","founder","createAt","film","releaseTime","status","region","introduction","hot","cover","duration","isDelete","methods","checkTel","console","AddtoCart","uid","aid","phone","seats","PostToCart","message","window","QueryFilmInfo","QueryFilmDetailArrangement","QueryFilmSeat","clickseat","alert","computed","totalprice","SelectSeat","seat_id","seatimg","mounted"],"sourceRoot":"src/views","sources":["seat.vue"],"sourcesContent":["<template>\r\n<div class=\"outbox\" >\r\n  <el-container>\r\n      \r\n  <el-header>\r\n      <el-steps :active=\"2\" align-center style=\"width:1200px;margin:0 auto\" >\r\n  <el-step title=\"步骤1\" description=\"选择电影场\"></el-step>\r\n  <el-step title=\"步骤2\" description=\"选择座位号\"></el-step>\r\n  <el-step title=\"步骤3\" description=\"加入购物车\"></el-step>\r\n  <el-step title=\"步骤4\" description=\"结尾付款\"></el-step>\r\n</el-steps>\r\n  </el-header>\r\n  <el-container >\r\n      <!-- 侧边电影信息 -->\r\n      <el-aside>\r\n          <!-- 电影海报地区等 -->\r\n          <h3 style=\"margin:20px auto;width:300px;text-align:center\">{{movie_info.arrangement.name}}</h3>\r\n          <div class=\"sidebox1\">\r\n           <img :src=\"movie_info.film.cover\"/>\r\n           <span >类型:{{movie_info.film.type}}</span><br/><br/>\r\n           <span>地区:{{movie_info.film.region}}</span><br/><br/>\r\n           <span>时长:{{movie_info.film.duration}}</span>\r\n          </div>\r\n          <!-- 时间票价放映类型 -->\r\n          <div class=\"boxside2\" >\r\n            <p>放映:{{movie_info.arrangement.type}}</p>\r\n            <p>开场:{{movie_info.arrangement.startTime}}</p>\r\n            <p>散场:{{movie_info.arrangement.endTime}}</p>\r\n            <p>票价:${{movie_info.arrangement.price}}</p>\r\n          </div>\r\n          <!-- 已选座位和价格 -->\r\n           <div class=\"boxside3\" >\r\n               <p>已选座位:{{selectdSeat}}</p>\r\n               <p>总计:<span>${{totalprice}}</span></p>\r\n           </div>\r\n           <!-- 填入手机号以及购物车 -->\r\n            <div class=\"boxside4\" >\r\n               <el-input placeholder=\"请输入手机号码\" v-model=\"phoneNumber\" @blur=\"checkTel()\" :style=\"isPassTel ?'':'border:0.5px solid red;width:280px'\"></el-input><br/>\r\n               <el-button class=\"addtocart\" @click=\"AddtoCart()\">加入购物车</el-button>\r\n           </div>\r\n      </el-aside>\r\n      <!-- 侧边电影信息结束 -->\r\n\r\n      <!-- 选座位界面 方法是生成一个新数组返回，点击座位的时候更换IMG的图像-->\r\n      <el-main>\r\n          <div class=\"mainbox1\">\r\n              <div ><img src=\"../assets/img/seat3.png\"/></div><span >可选座位</span>\r\n              <div ><img src=\"../assets/img/seat1.png\"/></div><span>已售座位</span>\r\n              <div ><img src=\"../assets/img/seat2.png\"/></div><span>已选座位</span>\r\n          </div>\r\n          <!-- 屏幕 -->\r\n          <div class=\"displayscreen\" >荧幕中央</div>\r\n          <!-- 选座位 -->\r\n          <div class=\"mainbox2\">\r\n             <div v-for=\"(item,index) in SelectSeat\" :key=\"index\"><el-button @click=\"clickseat(index)\" class=\"seatBTN\" ><img class=\"seatimg\" :src=\"item.seatimg\" /></el-button></div>\r\n             \r\n\r\n          </div>\r\n\r\n      </el-main>\r\n  </el-container>\r\n  </el-container>\r\n</div>\r\n</template>\r\n\r\n<script>\r\nimport{QueryFilmDetailArrangement,QueryFilmSeat,PostToCart}from \"@/api/film\"\r\n\r\nexport default {\r\n    data(){\r\n        return{\r\n            //座位样式\r\n            op_seat:require(\"../assets/img/seat3.png\"),\r\n            //验证手机号用\r\n            isPassTel:true,\r\n            // 包含座位的数量和已经选择的座位ID\r\n            film_anpai_info:{\r\n            select_seat:[],\r\n                //总座位\r\n            seatnum:0,\r\n                // 售出电影票信息保存\r\n            saledseat:[],\r\n            },\r\n            //手机号\r\n                phoneNumber:\"\",\r\n            //由座位数量生成包含 座位ID 座位的图片 的数组\r\n            film_anpai:[],\r\n            //座位样式\r\n            empty_seat:require(\"../assets/img/seat3.png\"),\r\n              buy_seat:require(\"../assets/img/seat2.png\"),\r\n             sale_seat:require(\"../assets/img/seat1.png\"),\r\n            //  用户选中的多个座位\r\n            selectdSeat:[], \r\n            //路由传参ID\r\n            Arrangement_id:this.$route.query.id,\r\n            //查询排片的电影详情传入的数组\r\n            movie_info:{\r\n                arrangement: {\r\nid: \"\",\r\nfid: \"\",\r\nname: \"\",\r\nseatNumber: 0,\r\nprice: 0,\r\ntype: \"\",\r\ndate: \"\",\r\nstartTime: \"\",\r\nboxOffice: 0,\r\nendTime: \"\",\r\nfounder: \"\",\r\ncreateAt: \"\"\r\n},\r\nfilm: {\r\nid: \"\",\r\nname: \"\",\r\nreleaseTime: \"\",\r\ntype: \"\",\r\nstatus: true,\r\nregion: \"\",\r\nintroduction: \"\",\r\nhot: 13,\r\ncover: \"\",\r\nduration: 0,\r\nisDelete: \"\",\r\n}},\r\n        }\r\n\r\n    },\r\n    methods:{\r\n        //手机号输入框的失去焦点时间\r\n\t\tcheckTel(){\r\n\t\t\tconst TelReg = /^1[3|4|5|7|8][0-9]\\d{8}$/ ;\r\n\t\t\tif(TelReg.test(this.phoneNumber)){\r\n\t\t\t\tthis.isPassTel=true;\r\n\t\t\t}else{\r\n\t\t\t\tthis.isPassTel=false;\r\n                this.$message.error(\"请输入正确格式的手机号码\");\r\n\t\t\t}\r\n\t\t\tconsole.log(this.isPassTel);\r\n\t\t},\r\n        //调用POST接口加入购物车和订单,加入购物车的按钮\r\n        AddtoCart(){\r\n            if(this.phoneNumber==null||this.selectdSeat.length==0||this.phoneNumber==\"\"||this.isPassTel==false)\r\n            {this.$message.error(\"请正确填写电话或者选择至少一个座位\")}\r\n           else{\r\n                const vo={\r\n                uid:parseInt(localStorage.getItem(\"uid\")),\r\n                aid:parseInt(this.Arrangement_id),\r\n                phone:this.phoneNumber,\r\n                seats:this.selectdSeat,\r\n                price:this.movie_info.arrangement.price,\r\n                     }\r\n            console.log(vo);\r\n            PostToCart(vo).then((res)=>{\r\n              if(res.code==200){\r\n                   if(res.data.success==\"success\"){\r\n                    this.$message({message:res.data.msg,type:\"success\"}\r\n                    );\r\n                    window.location.href=\"#/personal_center\";\r\n                   }\r\n                    else{\r\n                 this.$message({message:res.data.msg,type:\"warning\"},)\r\n                     }\r\n             }\r\n             else{ this.$message.error(\"fail\")}\r\n                                        })\r\n            \r\n                }\r\n        },\r\n        //调用查询排片的电影详情接口方法\r\n        QueryFilmInfo(){\r\n             QueryFilmDetailArrangement(this.Arrangement_id).then((res)=>{\r\n                 if(res.code==200){\r\n                 if(res.data.arrangement.id==this.Arrangement_id)\r\n                 {\r\n                     this.movie_info=res.data;\r\n                 };\r\n                 this.film_anpai_info.seatnum=this.movie_info.arrangement.seatNumber;\r\n                \r\n                 }\r\n             })\r\n        },\r\n\r\n        //调用查询排片的电影座位接口方法\r\n        QueryFilmSeat(){\r\n             QueryFilmSeat(this.Arrangement_id).then((res)=>{\r\n                 if(res.code==200){\r\n                    \r\n                     this.film_anpai_info.saledseat=res.data;\r\n                     console.log(this.film_anpai_info.saledseat);\r\n                 }\r\n             })\r\n        },\r\n\r\n        //点击座位触发的方法 包含显示已选座位的方法\r\n        clickseat(seatnum){\r\n              if(this.film_anpai[seatnum].seatimg==this.sale_seat){\r\n                  alert(\"座位已售出,请选择别的座位\");\r\n              }\r\n              else if(this.film_anpai[seatnum].seatimg==this.empty_seat)\r\n              {\r\n                  this.film_anpai[seatnum].seatimg=this.buy_seat;\r\n                  this.selectdSeat.push(seatnum+1);\r\n              }\r\n              else if(this.film_anpai[seatnum].seatimg==this.buy_seat)\r\n              {\r\n                  this.film_anpai[seatnum].seatimg=this.empty_seat;\r\n                  for(var i=0;i<this.selectdSeat.length;i++)\r\n                  {\r\n                      if(this.selectdSeat[i]==seatnum+1){this.selectdSeat.splice(i,1)}\r\n                  }\r\n              }\r\n        },\r\n    },\r\n    computed:{\r\n        //生成总价格价格\r\n        totalprice:function(){return(this.movie_info.arrangement.price*this.selectdSeat.length)},\r\n        //用来生成一个新的座位表,由座位数量生成包含 座位ID 座位的图片 的数组\r\n        SelectSeat:function(){\r\n            this.film_anpai=undefined;\r\n            this.film_anpai=new Array();\r\n            for(var i=0;i<this.film_anpai_info.seatnum;i++)\r\n            {\r\n                \r\n                this.film_anpai.push({seat_id:i,seatimg:this.empty_seat});\r\n            \r\n            }\r\n            for(var j=0;j<this.film_anpai_info.saledseat.length;j++)\r\n                {\r\n                     \r\n                     this.film_anpai[this.film_anpai_info.saledseat[j]-1].seatimg=this.sale_seat;\r\n                }\r\n            return this.film_anpai;\r\n        }\r\n    },\r\n    mounted:function(){\r\n        //调用查询电影详情接口方法\r\n       this.QueryFilmInfo();\r\n       //调用查询电影已选座位接口方法\r\n        this.QueryFilmSeat();\r\n    }\r\n\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.outbox{position: relative;\r\n    margin: 30px auto;\r\n    width:1600px;\r\n    height:1000px;\r\n    overflow:hidden}\r\n.el-header{\r\n    /* background-color: aquamarine; */\r\n    min-height: 100px;\r\n}\r\n.el-aside{\r\n    background-color:rgb(224, 224, 224);\r\n    color: honeydew;\r\n    min-width: 400px;\r\n    max-width: 600px;\r\n    min-height: 700px;\r\n    overflow:hidden;\r\n}\r\n.el-main{\r\n    background-color: rgb(235, 235, 235);\r\n    color: honeydew;\r\n    max-width: 1200px;\r\n    min-height: 700px;\r\n    padding: 0px;\r\n    \r\n}   \r\n\r\n/* 侧边 */\r\n.boxside2{width:300px;height:120px;margin:10px auto;overflow:hidden;padding:0px}\r\n.boxside2 p{\r\n    margin: 7px auto;\r\n    color:black;\r\n}\r\n.boxside3{border-top:1px solid black;border-bottom:1px solid black;width:300px;height:70px;margin:10px auto;overflow:hidden;padding:0px}\r\n.boxside3 p{\r\n    margin: 7px auto;\r\n    color:black;\r\n}\r\n.boxside4{width:300px;height:110px;margin:10px auto;overflow:hidden;padding:0px}\r\n.boxside4 p{\r\n    margin: 7px auto;\r\n    color:black;\r\n}\r\n.addtocart{color:white;margin:20px auto;width:180px;display:block;border: 1px solid rgb(255, 65, 65);border-radius:20px;background-color: rgb(255, 73, 73);}\r\n.sidebox1{\r\n    width:300px;height:250px;margin:30px auto;overflow:hidden\r\n}\r\n.sidebox1 img{height:250px;display:inline-block;float:left}\r\n.sidebox1 span{display:inline-block;float:left;color:black;margin-left:20px}\r\n/* 选座位 */\r\n.displayscreen{width:800px;height:30px;margin:0px auto;text-align:center;background-color:gray}\r\n.mainbox1{width:800px;height:50px;margin:30px auto;text-align:center}\r\n.mainbox1 div{width:50px;height:50px;overflow:hidden;display:inline-block;margin:0px 40px;padding:0}\r\n.mainbox1 img{height:40px}\r\n.mainbox1 span{display:inline-block;height:50px;line-height:50px;position:relative;top:-20px;left:-20px;color:black}\r\n.mainbox2{width:760px;height:700px;margin:20px auto;text-align:center;padding-top:50px}\r\n.mainbox2 div{display:inline-block;width:40px;height:40px;margin:10px}\r\n.seatBTN{background-color:transparent;border:none;width:40px;height:40px;}\r\n.seatBTN:hover{background-color: transparent;}\r\n.seatimg{position:relative;width:40px;left:-20px;top:-10px}\r\n</style>"]},"metadata":{},"sourceType":"module"}