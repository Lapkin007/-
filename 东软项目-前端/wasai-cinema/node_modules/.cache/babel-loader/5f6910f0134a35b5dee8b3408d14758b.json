{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { QueryFilmList, QueryFilmComment, PostFilmComment } from \"@/api/film\";\nexport default {\n  data: function data() {\n    return {\n      //电影信息\n      movie_info: [],\n      //评论信息\n      comment: [],\n      rate_visible: false,\n      form_comment: {\n        comment: \"\",\n        star: 0,\n        fid: \"\",\n        uid: \"\"\n      },\n      value: 3,\n      //评分表单\n      Film_id: this.$route.query.fid\n    };\n  },\n  methods: {\n    //电影详细信息\n    QueryMovieinfo: function QueryMovieinfo() {\n      var _this = this;\n\n      QueryFilmList().then(function (res) {\n        if (res.code == 200) {\n          for (var i = 0; i < res.data.length; i++) {\n            if (_this.Film_id == res.data[i].id) {\n              _this.movie_info = res.data[i];\n            }\n          }\n        }\n      });\n    },\n    //点击购票\n    ClickTicket: function ClickTicket() {\n      this.$router.push(\"/ticket?fid=\" + this.Film_id);\n    },\n    //点击评论\n    ClickPostComment: function ClickPostComment() {\n      var _this2 = this;\n\n      this.form_comment.fid = this.Film_id;\n      this.form_comment.uid = localStorage.getItem(\"uid\");\n      var PostComment = this.form_comment;\n      PostFilmComment(PostComment).then(function (res) {\n        if (res.code == 200) {\n          _this2.$message({\n            message: \"评论成功\",\n            type: \"success\"\n          });\n\n          _this2.rate_visible = false;\n        } else {\n          _this2.$message({\n            message: \"评论失败\",\n            type: \"warning\"\n          });\n        }\n      });\n    },\n    //电影评论信息\n    QueryMovieFE: function QueryMovieFE() {\n      var _this3 = this;\n\n      QueryFilmComment().then(function (res) {\n        if (res.code == 200) {\n          for (var i = 0; i < res.data.length; i++) {\n            if (_this3.Film_id == res.data[i].filmEvaluate.fid) {\n              _this3.comment.push(res.data[i]);\n            }\n          }\n\n          ;\n          console.log(_this3.comment);\n        }\n      });\n    },\n    //小功能\n    load: function load() {\n      this.count += 2;\n    },\n    isLogin: function isLogin(a) {\n      var _this4 = this;\n\n      if (localStorage.getItem(\"uid\") == null) {\n        this.$confirm('未检测到登录', '提示', {\n          confirmButtonText: '去登陆',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(function () {\n          _this4.$router.push(\"/login\");\n        });\n      }\n    }\n  },\n  mounted: function mounted() {\n    //查询电影列表并添加到movie_info列表\n    this.QueryMovieinfo(); //查询电影评论并添加到movie_comment列表\n\n    this.QueryMovieFE();\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2EA;AACA;AACAA,MADA,kBACA;AACA;AACA;AACAC,oBAFA;AAGA;AACAC,iBAJA;AAKAC,yBALA;AAMAC;AAAAF;AAAAG;AAAAC;AAAAC;AAAA,OANA;AAOAC,cAPA;AAQA;AACAC;AATA;AAYA,GAdA;AAeAC;AACA;AACAC,kBAFA,4BAEA;AAAA;;AACAC;AACA;AACA;AACA,iDACA;AAAA;AAAA;AACA;AACA;AACA,OAPA;AAQA,KAXA;AAYA;AACAC,eAbA,yBAaA;AACA;AACA,KAfA;AAgBA;AACAC,oBAjBA,8BAiBA;AAAA;;AACA;AACA;AACA;AACAC;AACA,6BACA;AACA;AAAAC;AAAAC;AAAA;;AACA;AACA,SAJA,MAKA;AACA;AAAAD;AAAAC;AAAA;AACA;AACA,OATA;AAUA,KA/BA;AAgCA;AACAC,gBAjCA,0BAiCA;AAAA;;AACAC;AACA;AACA;AACA,gEACA;AAAA;AAAA;AACA;;AAAA;AAAAC;AACA;AACA,OAPA;AAQA,KA1CA;AA4CA;AACAC,QA7CA,kBA6CA;AACA;AACA,KA/CA;AAgDAC,WAhDA,mBAgDAC,CAhDA,EAgDA;AAAA;;AACA;AACA;AACAC,kCADA;AAEAC,gCAFA;AAGAR;AAHA,WAIAS,IAJA,CAIA;AACA;AACA,SANA;AAMA;AACA;AAzDA,GAfA;AA0EAC;AACA;AACA,0BAFA,CAGA;;AACA;AACA;AA/EA","names":["data","movie_info","comment","rate_visible","form_comment","star","fid","uid","value","Film_id","methods","QueryMovieinfo","QueryFilmList","ClickTicket","ClickPostComment","PostFilmComment","message","type","QueryMovieFE","QueryFilmComment","console","load","isLogin","a","confirmButtonText","cancelButtonText","then","mounted"],"sourceRoot":"src/views","sources":["film_detail.vue"],"sourcesContent":["<template>\r\n  <div class=\"all\">\r\n      <el-container>\r\n          <!-- 上半 -->\r\n          <!-- 上方电影图片及按钮 -->\r\n         <el-header>\r\n             <div class=\"film_info\">\r\n              <img style=\"width: 240px;height:350px;float:left\" :src=\"movie_info.cover\" alt=\"error\"/>\r\n               <div class=\"film_detail_info_box\">\r\n              <h2 class=\"film_detail_name\">{{movie_info.name}}</h2>\r\n              <el-rate v-model=\"movie_info.hot\" disabled show-score text-color=\"#ff9900\" score-template=\"{value}\" class=\"rate\"></el-rate>\r\n              <span class=\"info_text1\">电影类型：&nbsp; {{movie_info.type}}</span>\r\n              <span class=\"info_text1\">地区:&nbsp;{{movie_info.region}}/时长:&nbsp;{{movie_info.duration}} </span>\r\n              <span class=\"info_text1\">上映日期：&nbsp;{{movie_info.releaseTime}} </span>\r\n              <!-- 购票按钮 -->\r\n              \r\n              <el-button class=\"btn\" @click=\"ClickTicket()\">特惠购票</el-button>\r\n              <!-- 评分按钮 -->\r\n              <el-button class=\"btn\" @click=\"rate_visible = true;isLogin()\">评分</el-button>\r\n               <el-dialog title=\"电影评分\" :visible.sync=\"rate_visible\" width=\"50%\"  >\r\n               <el-form :model=\"form_comment\">\r\n                   <el-form-item label=\"\" >\r\n                   <el-rate v-model=\"form_comment.star\" show-score text-color=\"#ff9900\"></el-rate>\r\n                   </el-form-item>\r\n                <el-form-item label=\"\" >\r\n               <el-input v-model=\"form_comment.comment\" autocomplete=\"off\" type=\"textarea\" maxlength=\"20\" show-word-limit :autosize=\"{ minRows: 10, maxRows: 10}\"\r\n                 placeholder=\"请输入内容\"></el-input>\r\n               </el-form-item>\r\n               </el-form>\r\n               <span slot=\"footer\" class=\"dialog-footer\">\r\n               <el-button @click=\"rate_visible = false\">取 消</el-button>\r\n               <el-button type=\"primary\" @click=\"ClickPostComment()\">确认提交</el-button>\r\n               </span>\r\n               </el-dialog>\r\n               </div>\r\n             </div>\r\n         </el-header>\r\n         <!-- 上半结束 -->\r\n\r\n         <!-- 间幕不要动 -->\r\n         <el-link icon=\"el-icon-back\" href=\"/\" :underline=\"false\" class=\"middle_ellink\" >返回</el-link>\r\n         <span class=\"middle_span\" >详情页面</span>\r\n         <!-- 间幕结束 -->\r\n\r\n         <!-- 下半 -->\r\n         <el-main>\r\n             <h1 class=\"title\">剧情简介</h1>\r\n             \r\n             <!-- 剧情简介 -->\r\n             <p class=\"shortdesc\">{{movie_info.introduction}}\r\n             \r\n             </p>\r\n              <!-- 剧情简介结束 -->\r\n\r\n             <h1 style=\"text-align:left;color:black\">电影评论</h1>\r\n\r\n             <!-- 电影评论 -->\r\n               <ul class=\"movie_comment_box\" v-infinite-scroll=\"load\" style=\"overflow:auto\">\r\n                   <li v-for=\"(item,index) in comment\" :key=\"index\">\r\n                       <img :src=\"item.user.avatar\" class=\"movie_comment_img\" />\r\n                       <span class=\"movie_comment_span1\">{{item.user.nickname}}</span>\r\n                       <el-rate v-model=\"item.filmEvaluate.star\" disabled show-score text-color=\"#ff9900\" score-template=\"{value}\" class=\"movie_comment_rate\"></el-rate><br/>\r\n                       <span class=\"movie_comment_span2\">{{item.filmEvaluate.comment}}</span>\r\n                       <span class=\"movie_comment_span3\">{{item.filmEvaluate.createAt}}</span>\r\n                   </li>\r\n               </ul>\r\n             <!-- 电影评论结束 -->\r\n\r\n         </el-main>\r\n         <!-- 下半结束 -->\r\n      </el-container>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {QueryFilmList,QueryFilmComment,PostFilmComment} from \"@/api/film\";\r\nexport default {\r\n    data(){\r\n        return{\r\n            //电影信息\r\n            movie_info:[],\r\n             //评论信息\r\n            comment:[],\r\n            rate_visible:false,\r\n            form_comment:{comment:\"\",star:0,fid:\"\",uid:\"\"},\r\n            value: 3,\r\n            //评分表单\r\n            Film_id:this.$route.query.fid,\r\n\r\n        }\r\n    },\r\n    methods: {\r\n        //电影详细信息\r\n        QueryMovieinfo(){\r\n            QueryFilmList().then((res)=>{\r\n                if(res.code==200){\r\n                   for(var i=0;i<res.data.length;i++){\r\n                  if(this.Film_id==res.data[i].id)\r\n                  {this.movie_info=res.data[i]}\r\n                }\r\n                }\r\n            })\r\n        },\r\n        //点击购票\r\n        ClickTicket(){\r\n        this.$router.push(\"/ticket?fid=\"+this.Film_id);\r\n        },\r\n        //点击评论\r\n        ClickPostComment(){\r\n            this.form_comment.fid=this.Film_id;\r\n            this.form_comment.uid=localStorage.getItem(\"uid\");\r\n            const PostComment=this.form_comment;\r\n            PostFilmComment(PostComment).then((res)=>{\r\n                if(res.code==200)\r\n                {\r\n                    this.$message({message:\"评论成功\",type:\"success\"},);\r\n                    this.rate_visible = false;\r\n                    }\r\n                else{\r\n                    this.$message({message:\"评论失败\",type:\"warning\"},);\r\n                }\r\n            })\r\n        },\r\n         //电影评论信息\r\n            QueryMovieFE(){\r\n            QueryFilmComment().then((res)=>{\r\n                if(res.code==200){\r\n                   for(var i=0;i<res.data.length;i++){\r\n                  if(this.Film_id==res.data[i].filmEvaluate.fid)\r\n                  {this.comment.push(res.data[i])}\r\n                };console.log(this.comment)\r\n                }\r\n            })\r\n        },\r\n\r\n        //小功能\r\n      load () {\r\n        this.count += 2\r\n      },\r\n      isLogin(a) {\r\n        if(localStorage.getItem(\"uid\")==null){\r\n        this.$confirm('未检测到登录', '提示', {\r\n          confirmButtonText: '去登陆',\r\n          cancelButtonText: '取消',\r\n          type: 'warning'\r\n        }).then(() => {\r\n          this.$router.push(\"/login\");\r\n        });}\r\n        },\r\n    },\r\n    mounted:function(){\r\n        //查询电影列表并添加到movie_info列表\r\n        this.QueryMovieinfo();\r\n        //查询电影评论并添加到movie_comment列表\r\n        this.QueryMovieFE();\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n/* 全局及header和main设置 */\r\n.all{\r\n    width:100%;\r\n    height:100%;\r\n    text-align: center;\r\n}\r\n.el-header{\r\n    background-color: rgb(78, 89, 241);\r\n    color: honeydew;\r\n    min-height:100px;\r\n    width:1400px;\r\n    margin: 0 auto;\r\n    max-height: 350px;\r\n    min-height: 350px;\r\n}\r\n.el-main{\r\n    margin: 0 auto;\r\n    /* background-color: blueviolet; */\r\n    color: honeydew;\r\n    width:1100px;\r\n    max-height:400px;\r\n    min-height:400px;\r\n    overflow:auto\r\n}\r\n/* 上方电影图片及按钮CSS */\r\n.film_info{\r\n    width:1100px;\r\n    height:400px;\r\n    /* background-color: rgb(90, 155, 117); */\r\n    position: relative;\r\n    margin: 50px auto;\r\n}\r\n.film_detail_name{\r\n    display: inline-block;\r\n    float:left;\r\n    font-size:30px;\r\n    color:white;\r\n    width:300px;\r\n    /* background-color: brown; */\r\n    text-align: left;\r\n    height: 50px;\r\n    line-height: 50px;\r\n    margin: 0px;\r\n    overflow: hidden !important;\r\n}\r\n.film_detail_info_box{\r\n    float:left;margin-left:60px;position:relative;\r\n    /* background-color: blue; */\r\n    height: 400px;\r\n    width:500px;\r\n    }\r\n.rate{\r\n    display: inline-block;\r\n    /* background-color: aqua; */\r\n    height: 100px;\r\n    margin-top:40px ;\r\n    width: 200px;\r\n    text-align: left;\r\n}\r\n.info_text1{\r\n    height: 30px;\r\n    line-height: 30px;\r\n    /* background-color: aqua; */\r\n    display: block;\r\n    text-align: left;\r\n}\r\n.btn{\r\n    margin-top:15px;\r\n    background-color: rgb(243, 77, 77);\r\n    border: none;\r\n    color: white;\r\n    float: left;\r\n    width: 100px;\r\n    margin-right: 20px;\r\n    font-size: 13px;\r\n}\r\n.el-rate__text{\r\n    margin-top:-5px !important ;\r\n}\r\n/* 间幕 */\r\n.middle_span{display:inline-block;text-align:left;width:90px;margin-left:380px;margin-top:10px;font-size:20px;color:black}\r\n.middle_ellink{margin-bottom:10px;display:block;font-size:16px;width:100px;margin-left:350px;margin-top:60px}\r\n/* 剧情简介及标题 */\r\n.shortdesc{text-indent:30px;text-align:left;color:black}\r\n.title{text-align:left;color:black}\r\n/* 电影评论CSS */\r\n.movie_comment_box{\r\n    list-style-type: none;\r\n    margin: 0;\r\n    padding:0;\r\n}\r\n.movie_comment_box li{\r\n    text-align: left;\r\n    height:80px;\r\n    margin-bottom: 20px;\r\n}\r\n.movie_comment_box li img{\r\n    width:60px;height:60px;border:1px solid gray;border-radius:60px;\r\n}\r\n.movie_comment_img{display:inline-block;float:left}\r\n.movie_comment_span1{display:inline-block;float:left;margin-left:20px;color:black;width:100px}\r\n.movie_comment_rate{display: inline-block;\r\n    height: 100px;\r\n    margin-top:40px ;\r\n    width: 200px;\r\n    text-align: left;height:30px;margin:0;margin-left:50px}\r\n.movie_comment_span2{font-size:20px;margin-left:50px;color:gray}\r\n.movie_comment_span3{float:right;color:gray}\r\n</style>"]},"metadata":{},"sourceType":"module"}