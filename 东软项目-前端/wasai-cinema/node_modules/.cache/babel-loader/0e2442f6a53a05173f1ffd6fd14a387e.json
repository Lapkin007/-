{"ast":null,"code":"\"use strict\";\n\nvar _typeof = require(\"E:/DW/wasai-cinema/node_modules/@babel/runtime/helpers/typeof.js\").default;\n\nvar _toConsumableArray = require(\"E:/DW/wasai-cinema/node_modules/@babel/runtime/helpers/toConsumableArray.js\").default;\n\nvar _taggedTemplateLiteral = require(\"E:/DW/wasai-cinema/node_modules/@babel/runtime/helpers/taggedTemplateLiteral.js\").default;\n\nvar _templateObject, _templateObject2, _templateObject3, _templateObject4, _templateObject5;\n\nrequire(\"core-js/modules/es.error.cause.js\");\n\nrequire(\"core-js/modules/es.array.map.js\");\n\nrequire(\"core-js/modules/es.array.concat.js\");\n\nrequire(\"core-js/modules/es.function.name.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar code_1 = require(\"../code\");\n\nvar codegen_1 = require(\"../../compile/codegen\");\n\nvar names_1 = require(\"../../compile/names\");\n\nvar util_1 = require(\"../../compile/util\");\n\nvar error = {\n  message: \"must NOT have additional properties\",\n  params: function params(_ref) {\n    var _params = _ref.params;\n    return (0, codegen_1._)(_templateObject || (_templateObject = _taggedTemplateLiteral([\"{additionalProperty: \", \"}\"])), _params.additionalProperty);\n  }\n};\nvar def = {\n  keyword: \"additionalProperties\",\n  type: [\"object\"],\n  schemaType: [\"boolean\", \"object\"],\n  allowUndefined: true,\n  trackErrors: true,\n  error: error,\n  code: function code(cxt) {\n    var gen = cxt.gen,\n        schema = cxt.schema,\n        parentSchema = cxt.parentSchema,\n        data = cxt.data,\n        errsCount = cxt.errsCount,\n        it = cxt.it;\n    /* istanbul ignore if */\n\n    if (!errsCount) throw new Error(\"ajv implementation error\");\n    var allErrors = it.allErrors,\n        opts = it.opts;\n    it.props = true;\n    if (opts.removeAdditional !== \"all\" && (0, util_1.alwaysValidSchema)(it, schema)) return;\n    var props = (0, code_1.allSchemaProperties)(parentSchema.properties);\n    var patProps = (0, code_1.allSchemaProperties)(parentSchema.patternProperties);\n    checkAdditionalProperties();\n    cxt.ok((0, codegen_1._)(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"\", \" === \", \"\"])), errsCount, names_1.default.errors));\n\n    function checkAdditionalProperties() {\n      gen.forIn(\"key\", data, function (key) {\n        if (!props.length && !patProps.length) additionalPropertyCode(key);else gen.if(isAdditional(key), function () {\n          return additionalPropertyCode(key);\n        });\n      });\n    }\n\n    function isAdditional(key) {\n      var definedProp;\n\n      if (props.length > 8) {\n        // TODO maybe an option instead of hard-coded 8?\n        var propsSchema = (0, util_1.schemaRefOrVal)(it, parentSchema.properties, \"properties\");\n        definedProp = (0, code_1.isOwnProperty)(gen, propsSchema, key);\n      } else if (props.length) {\n        definedProp = (0, codegen_1.or).apply(void 0, _toConsumableArray(props.map(function (p) {\n          return (0, codegen_1._)(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"\", \" === \", \"\"])), key, p);\n        })));\n      } else {\n        definedProp = codegen_1.nil;\n      }\n\n      if (patProps.length) {\n        definedProp = (0, codegen_1.or).apply(void 0, [definedProp].concat(_toConsumableArray(patProps.map(function (p) {\n          return (0, codegen_1._)(_templateObject4 || (_templateObject4 = _taggedTemplateLiteral([\"\", \".test(\", \")\"])), (0, code_1.usePattern)(cxt, p), key);\n        }))));\n      }\n\n      return (0, codegen_1.not)(definedProp);\n    }\n\n    function deleteAdditional(key) {\n      gen.code((0, codegen_1._)(_templateObject5 || (_templateObject5 = _taggedTemplateLiteral([\"delete \", \"[\", \"]\"])), data, key));\n    }\n\n    function additionalPropertyCode(key) {\n      if (opts.removeAdditional === \"all\" || opts.removeAdditional && schema === false) {\n        deleteAdditional(key);\n        return;\n      }\n\n      if (schema === false) {\n        cxt.setParams({\n          additionalProperty: key\n        });\n        cxt.error();\n        if (!allErrors) gen.break();\n        return;\n      }\n\n      if (_typeof(schema) == \"object\" && !(0, util_1.alwaysValidSchema)(it, schema)) {\n        var valid = gen.name(\"valid\");\n\n        if (opts.removeAdditional === \"failing\") {\n          applyAdditionalSchema(key, valid, false);\n          gen.if((0, codegen_1.not)(valid), function () {\n            cxt.reset();\n            deleteAdditional(key);\n          });\n        } else {\n          applyAdditionalSchema(key, valid);\n          if (!allErrors) gen.if((0, codegen_1.not)(valid), function () {\n            return gen.break();\n          });\n        }\n      }\n    }\n\n    function applyAdditionalSchema(key, valid, errors) {\n      var subschema = {\n        keyword: \"additionalProperties\",\n        dataProp: key,\n        dataPropType: util_1.Type.Str\n      };\n\n      if (errors === false) {\n        Object.assign(subschema, {\n          compositeRule: true,\n          createErrors: false,\n          allErrors: false\n        });\n      }\n\n      cxt.subschema(subschema, valid);\n    }\n  }\n};\nexports.default = def;","map":{"version":3,"mappings":"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","names":["error","message","params","additionalProperty","def","keyword","type","schemaType","allowUndefined","trackErrors","code","cxt","gen","schema","parentSchema","data","errsCount","it","Error","allErrors","opts","props","removeAdditional","properties","patProps","patternProperties","checkAdditionalProperties","ok","names_1","errors","forIn","key","length","additionalPropertyCode","if","isAdditional","definedProp","propsSchema","map","p","codegen_1","deleteAdditional","setParams","break","valid","name","applyAdditionalSchema","reset","subschema","dataProp","dataPropType","util_1","Str","Object","assign","compositeRule","createErrors","exports"],"sourceRoot":"","sources":["../../../lib/vocabularies/applicator/additionalProperties.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}