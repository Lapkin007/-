{"ast":null,"code":"import \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/web.url.js\";\nimport \"core-js/modules/web.url-search-params.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.array.splice.js\";\nimport \"core-js/modules/es.array.sort.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { ModifySelf } from \"@/api/user\";\nimport { QueryCart, DeleteCart } from \"@/api/cart\";\nimport { QueryOrderByUid, SimPaySuccess, SimPayFail } from \"@/api/order\";\nimport { parseTime } from \"@/plugins/DateTran\"; //日期格式转化\n\nexport default {\n  data: function data() {\n    return {\n      //个人设置信息单\n      imageUrl: null,\n      dynamicValidateForm: {\n        domains: [{\n          value: null\n        }],\n        email: null //邮箱\n\n      },\n      ruleForm: {\n        pass: null\n      },\n      //密码\n      form: {\n        name: null,\n        //昵称\n        region: null,\n        date1: null,\n        //生日\n        date2: null,\n        delivery: false,\n        type: [],\n        sex: null,\n        // 性别\n        desc: null //个人介绍\n\n      },\n      fileName: null,\n      //暂存信息\n      item: {},\n      index: 99,\n      //  Tab页的切换显示\n      activeTab: this.$store.state.activeTab,\n      //  选中框存放序列\n      selectItem: [],\n      //购物车删除弹框\n      confirmDelete: false,\n      //确认结算弹框开关\n      confirmPay: false,\n      confirmPay2: false,\n      checkAll: false,\n      isIndeterminate: true,\n      //购物车\n      cart_list: [],\n      //订单\n      ticket_state: [{\n        img: require(\"../assets/filmImg/error.gif\"),\n        film_name: \"狮子王\",\n        seat: 30,\n        start_time: \"2022/3/27 12:00\",\n        end_time: \"2022/3/27 12:00\",\n        state: 0,\n        price: 30\n      }, {\n        img: require(\"../assets/filmImg/error.gif\"),\n        film_name: \"狮子王\",\n        seat: 30,\n        start_time: \"2022/3/27 12:00\",\n        end_time: \"2022/3/27 12:00\",\n        state: 1,\n        price: 10\n      }, {\n        img: require(\"../assets/filmImg/error.gif\"),\n        film_name: \"狮子王\",\n        seat: 30,\n        start_time: \"2022/3/27 12:00\",\n        end_time: \"2022/3/27 12:00\",\n        state: 2,\n        price: 50\n      }, {\n        img: require(\"../assets/filmImg/error.gif\"),\n        film_name: \"狮子王\",\n        seat: 30,\n        start_time: \"2022/3/27 12:00\",\n        end_time: \"2022/3/27 12:00\",\n        state: 3,\n        price: 50\n      }],\n      //支付状态\n      state0: [{\n        color: \"orange\"\n      }, {\n        state_desc: \"等待支付\"\n      }],\n      state1: [{\n        color: \"red\"\n      }, {\n        state_desc: \"支付失败\"\n      }],\n      state2: [{\n        color: \"green\"\n      }, {\n        state_desc: \"支付成功\"\n      }],\n      state3: [{\n        color: \"blue\"\n      }, {\n        state_desc: \"已被撤销\"\n      }]\n    };\n  },\n  computed: {\n    totalprice: function totalprice() {\n      var total_price = 0;\n\n      for (var i = 0; i < this.selectItem.length; i++) {\n        total_price = total_price + this.cart_list[this.selectItem[i]].cart.price;\n      }\n\n      return total_price;\n    }\n  },\n  methods: {\n    //个人信息\n    beforeAvatarUpload: function beforeAvatarUpload(file) {\n      var isJPG = file.type === 'image/jpeg';\n      var isPNG = file.type === 'image/png';\n      var isLt2M = file.size / 2048 / 2048 < 2;\n\n      if (!isJPG & !isPNG) {\n        this.$message.error('上传头像图片只能是 JPG 或者 PNG 格式!');\n      }\n\n      if (!isLt2M) {\n        this.$message.error('上传头像图片大小不能超过 8MB!');\n      }\n\n      return isPNG & isJPG && isLt2M;\n    },\n    handleAvatarSuccess: function handleAvatarSuccess(res, file) {\n      console.log(res.data.fileName);\n      this.fileName = res.data.fileName;\n      this.imageUrl = URL.createObjectURL(file.raw);\n    },\n    onSubmit2: function onSubmit2() {\n      var _this = this;\n\n      var data = {\n        password: this.ruleForm.pass,\n        avatar: this.fileName,\n        nickname: this.form.name,\n        email: this.dynamicValidateForm.email,\n        birthday: this.form.date1,\n        gender: this.form.sex,\n        info: this.form.desc,\n        id: localStorage.getItem(\"uid\")\n      };\n      console.log(data);\n\n      if (this.ruleForm.pass != null) {\n        if (data.password.length < 6) {\n          this.$message.error(\"请输入6位以上的密码\");\n        } else {\n          ModifySelf(data).then(function (res) {\n            if (res.code == 200) {\n              if (res.data.success == \"success\") {\n                _this.$message({\n                  message: res.data.msg,\n                  type: res.data.success\n                });\n\n                window.location.reload();\n              } else {\n                _this.$message.error(\"更新失败\");\n              }\n            } else {\n              _this.$message.error(\"请求失败\");\n            }\n          });\n        }\n      } else {\n        ModifySelf(data).then(function (res) {\n          if (res.code == 200) {\n            if (res.data.success == \"success\") {\n              _this.$message({\n                message: res.data.msg,\n                type: res.data.success\n              });\n\n              window.location.reload();\n            } else {\n              _this.$message.error(\"更新失败\");\n            }\n          } else {\n            _this.$message.error(\"请求失败\");\n          }\n        });\n      }\n    },\n    //删除弹框方法\n    ClickDelete: function ClickDelete(item, index) {\n      this.item = item;\n      this.index = index;\n      this.confirmDelete = true;\n    },\n    onSubmit: function onSubmit() {\n      console.log('submit!');\n    },\n    //模拟支付成功\n    SuccessPay: function SuccessPay() {\n      var _this2 = this;\n\n      for (var i = 0; i < this.selectItem.length; i++) {\n        var vo = this.cart_list[i];\n        SimPaySuccess(vo).then(function (res) {\n          if (res.code == 200) {\n            if (res.data.success == \"success\") {\n              _this2.$message({\n                message: res.data.msg,\n                type: \"success\"\n              });\n            } else {\n              _this2.$message({\n                message: res.data.msg,\n                type: \"warning\"\n              });\n            }\n          } else {\n            _this2.$message.error(\"支付失败\");\n          }\n\n          window.location.reload();\n        });\n        console.log(vo);\n      }\n\n      this.confirmPay2 = false;\n    },\n    //模拟支付失败\n    FailPay: function FailPay() {\n      var _this3 = this;\n\n      for (var i = 0; i < this.selectItem.length; i++) {\n        var vo = this.cart_list[i];\n        SimPayFail(vo).then(function (res) {\n          if (res.code == 200) {\n            if (res.data.success == \"success\") {\n              _this3.$message({\n                message: res.data.msg,\n                type: \"success\"\n              });\n            } else {\n              _this3.$message({\n                message: res.data.msg,\n                type: \"warning\"\n              });\n            }\n          } else {\n            _this3.$message.error(\"支付失败\");\n          }\n\n          window.location.reload();\n        });\n        console.log(vo);\n      }\n\n      this.confirmPay2 = false;\n    },\n    //点击确认支付按钮\n    cilckconfirmPay: function cilckconfirmPay() {\n      if (this.totalprice != 0) {\n        this.confirmPay = true;\n      } else {\n        this.$message({\n          message: \"请先选中一个订单\",\n          type: \"warning\"\n        });\n      }\n    },\n    //删除按钮\n    HandleDeleteCartItem: function HandleDeleteCartItem(item, index) {\n      var _this4 = this;\n\n      DeleteCart(item.cart).then(function (res) {\n        if (res.code == 200) {\n          _this4.cart_list.splice(index, 1);\n        } else {\n          _this4.$message.error(\"删除失败\");\n        }\n      });\n      window.location.reload();\n    },\n    //确认结算弹框\n    handleClose: function handleClose(done) {\n      this.$confirm('确认关闭？').then(function (_) {\n        done();\n      }).catch(function (_) {});\n    },\n    //改变支付状态样式和判断支付样式的方法\n    changeStateCSS: function changeStateCSS(item) {\n      if (item.order.status == 0) {\n        return this.state0[0];\n      }\n\n      if (item.order.status == 1) {\n        return this.state1[0];\n      }\n\n      if (item.order.status == 2) {\n        return this.state2[0];\n      }\n\n      if (item.order.status == 3) {\n        return this.state3[0];\n      }\n    },\n    changeState: function changeState(item) {\n      if (item.order.status == 0) {\n        return this.state0[1].state_desc;\n      }\n\n      if (item.order.status == 1) {\n        return this.state1[1].state_desc;\n      }\n\n      if (item.order.status == 2) {\n        return this.state2[1].state_desc;\n      }\n\n      if (item.order.status == 3) {\n        return this.state3[1].state_desc;\n      }\n    },\n    // 按下全选按钮的方法\n    handleCheckAllChange: function handleCheckAllChange(val) {\n      if (this.checkAll == true) {\n        this.selectItem = undefined;\n        this.selectItem = new Array();\n\n        for (var i = 0; i < this.cart_list.length; i++) {\n          this.selectItem.push(i);\n        }\n      }\n\n      if (this.checkAll == false) {\n        this.selectItem = undefined;\n        this.selectItem = new Array();\n      }\n\n      this.isIndeterminate = false;\n    },\n    // 按下选中按钮的方法\n    handleCheckedCitiesChange: function handleCheckedCitiesChange(value) {\n      //重新排序的方法\n      var compare = function compare(x, y) {\n        if (x < y) {\n          return -1;\n        } else if (x > y) {\n          return 1;\n        } else {\n          return 0;\n        }\n      };\n\n      this.selectItem = this.selectItem.sort(compare);\n      console.log(this.selectItem);\n      var checkedCount = value.length;\n      this.checkAll = checkedCount === this.selectItem.length;\n      this.isIndeterminate = checkedCount > 0 && checkedCount < this.selectItem.length;\n\n      if (this.selectItem.length == this.cart_list.length) {\n        this.checkAll = true;\n      }\n    },\n    //购物车接口,输入Cart_List\n    Add_Cart_List: function Add_Cart_List() {\n      var _this5 = this;\n\n      QueryCart(parseInt(localStorage.getItem(\"uid\"))).then(function (res) {\n        if (res.code == 200) {\n          console.log(\"购物车接口数据\");\n          console.log(res);\n          _this5.cart_list = res.data;\n\n          for (var i = 0; i < _this5.cart_list.length; i++) {\n            _this5.cart_list[i].arr.date = parseTime(new Date(_this5.cart_list[i].arr.date), \"{y}-{m}-{d}\");\n          }\n        }\n      });\n    },\n    //订单接口，输入 ticket_state\n    AddtoOrderList: function AddtoOrderList() {\n      var _this6 = this;\n\n      QueryOrderByUid(parseInt(localStorage.getItem(\"uid\"))).then(function (res) {\n        if (res.code == 200) {\n          console.log(\"用户订单接口数据\");\n          _this6.ticket_state = res.data;\n\n          for (var i = 0; i < _this6.ticket_state.length; i++) {\n            _this6.ticket_state[i].arr.date = parseTime(new Date(_this6.ticket_state[i].arr.date), \"{y}-{m}-{d}\");\n          }\n        }\n      });\n    }\n  },\n  beforeCreate: function beforeCreate() {\n    console.log(\"BeforeCreate\");\n    this.$store.state.navnum = 0;\n    this.$store.state.color3.color = \"#5b5d63\";\n    this.$store.state.color1.color = \"#5b5d63\";\n    this.$store.state.color2.color = \"#5b5d63\";\n    this.$store.state.color4.color = \"#5b5d63\";\n  },\n  created: function created() {\n    console.log(\"查询购物车方法QueryCart,获取其中的购物车信息,添加到cart_list,并且清空Cart_list\");\n    this.cart_list = undefined;\n    this.cart_list = new Array();\n    this.ticket_state = undefined;\n    this.ticket_state = new Array();\n    this.Add_Cart_List();\n    this.AddtoOrderList();\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsLA;AACA;AACA;AACA,+C,CAAA;;AACA;AACAA,MADA,kBACA;AACA;AACA;AACAC,oBAFA;AAGAC;AACAC,kBACA;AACAC;AADA,SADA,CADA;AAMAC,mBANA,CAMA;;AANA,OAHA;AAWAC;AAAAC;AAAA,OAXA;AAWA;AACAC;AACAC,kBADA;AACA;AACAC,oBAFA;AAGAC,mBAHA;AAGA;AACAC,mBAJA;AAKAC,uBALA;AAMAC,gBANA;AAOAC,iBAPA;AAOA;AACAC,kBARA,CAQA;;AARA,OAZA;AAsBAC,oBAtBA;AAwBA;AACAC,cAzBA;AA0BAC,eA1BA;AA2BA;AACAC,4CA5BA;AA6BA;AACAC,oBA9BA;AA+BA;AACAC,0BAhCA;AAiCA;AACAC,uBAlCA;AAmCAC,wBAnCA;AAoCAC,qBApCA;AAqCAC,2BArCA;AAsCA;AACAC,mBAvCA;AAwCA;AACAC,qBACA;AAAAC;AAAAC;AAAAC;AAAAC;AAAAC;AAAAC;AAAAC;AAAA,OADA,EAEA;AAAAN;AAAAC;AAAAC;AAAAC;AAAAC;AAAAC;AAAAC;AAAA,OAFA,EAGA;AAAAN;AAAAC;AAAAC;AAAAC;AAAAC;AAAAC;AAAAC;AAAA,OAHA,EAIA;AAAAN;AAAAC;AAAAC;AAAAC;AAAAC;AAAAC;AAAAC;AAAA,OAJA,CAzCA;AA+CA;AACAC;AAAAC;AAAA;AAAAC;AAAA,QAhDA;AAiDAC;AAAAF;AAAA;AAAAC;AAAA,QAjDA;AAkDAE;AAAAH;AAAA;AAAAC;AAAA,QAlDA;AAmDAG;AAAAJ;AAAA;AAAAC;AAAA;AAnDA;AAsDA,GAxDA;AAyDAI;AACAC;AACA;;AACA,uDACA;AAAAC;AAAA;;AACA;AACA;AANA,GAzDA;AAiEAC;AACA;AACAC,sBAFA,8BAEAC,IAFA,EAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AACA;AACA;AACA;;AACA;AACA,KAdA;AAeAC,uBAfA,+BAeAC,GAfA,EAeAF,IAfA,EAeA;AACAG;AACA;AACA;AAEA,KApBA;AAqBAC,aArBA,uBAqBA;AAAA;;AACA;AACAC,oCADA;AAEAC,6BAFA;AAGAC,gCAHA;AAIAjD,6CAJA;AAKAkD,iCALA;AAMAC,6BANA;AAOAC,4BAPA;AAQAC;AARA;AAUAR;;AACA,sCACA;AAAA,sCACA;AAAA;AAAA,SADA,MAEA;AACAS;AACA,iCACA;AACA,iDACA;AACA;AAAAC;AAAA9C;AAAA;;AACA+C;AACA,eAJA,MAKA;AACA;AACA;AACA,aAVA,MAWA;AACA;AACA;AACA,WAfA;AAgBA;AACA,OArBA,MAsBA;AACAF;AACA,+BACA;AACA,+CACA;AACA;AAAAC;AAAA9C;AAAA;;AACA+C;AACA,aAJA,MAKA;AACA;AACA;AACA,WAVA,MAWA;AACA;AACA;AACA,SAfA;AAgBA;AAIA,KA5EA;AA6EA;AACAC,eA9EA,uBA8EA5C,IA9EA,EA8EAC,KA9EA,EA+EA;AACA;AACA;AACA;AACA,KAnFA;AAoFA4C,YApFA,sBAoFA;AACAb;AACA,KAtFA;AAuFA;AACAc,cAxFA,wBAwFA;AAAA;;AACA,uDACA;AACA;AACAC;AACA,+BACA;AACA;AACA;AAAAL;AAAA9C;AAAA;AACA,aAFA,MAGA;AACA;AAAA8C;AAAA9C;AAAA;AACA;AACA,WARA,MASA;AACA;AACA;;AACA+C;AACA,SAdA;AAeAX;AACA;;AACA;AACA,KA9GA;AA+GA;AACAgB,WAhHA,qBAgHA;AAAA;;AACA,uDACA;AACA;AACAC;AACA,+BACA;AACA;AACA;AAAAP;AAAA9C;AAAA;AACA,aAFA,MAGA;AACA;AAAA8C;AAAA9C;AAAA;AACA;AACA,WARA,MASA;AACA;AACA;;AACA+C;AACA,SAdA;AAeAX;AACA;;AACA;AACA,KAtIA;AAuIA;AACAkB,mBAxIA,6BAwIA;AACA,gCACA;AACA;AACA,OAHA,MAIA;AACA;AAAAR;AAAA9C;AAAA;AACA;AAEA,KAjJA;AAkJA;AACAuD,wBAnJA,gCAmJAnD,IAnJA,EAmJAC,KAnJA,EAmJA;AAAA;;AACAmD;AACA;AACA;AACA,SAFA,MAGA;AACA;AACA;AACA,OAPA;AAQAT;AACA,KA7JA;AA8JA;AACAU,eA/JA,uBA+JAC,IA/JA,EA+JA;AACA,6BACAC,IADA,CACA;AACAD;AACA,OAHA,EAIAE,KAJA,CAIA,eAJA;AAKA,KArKA;AAsKA;AACAC,kBAvKA,0BAuKAzD,IAvKA,EAuKA;AACA;AAAA;AAAA;;AACA;AAAA;AAAA;;AACA;AAAA;AAAA;;AACA;AAAA;AAAA;AACA,KA5KA;AA6KA0D,eA7KA,uBA6KA1D,IA7KA,EA6KA;AACA;AAAA;AAAA;;AACA;AAAA;AAAA;;AACA;AAAA;AAAA;;AACA;AAAA;AAAA;AACA,KAlLA;AAmLA;AACA2D,wBApLA,gCAoLAC,GApLA,EAoLA;AACA,iCACA;AAAA;AAAA;;AACA;AAAA;AAAA;AACA;;AACA,kCACA;AAAA;AAAA;AAAA;;AACA;AACA,KA5LA;AA6LA;AACAC,6BA9LA,qCA8LA3E,KA9LA,EA8LA;AACA;AACA;AACA;AAAA;AAAA,eACA;AAAA;AAAA,eACA;AAAA;AAAA;AACA,OAJA;;AAKA;AACA8C;AACA;AACA;AACA;;AACA;AAAA;AAAA;AACA,KA3MA;AA4MA;AACA8B,iBA7MA,2BA6MA;AAAA;;AACAC;AACA,6BACA;AACA/B;AACAA;AACA;;AACA,4DACA;AAEA;AAEA;AACA;AACA,OAbA;AAcA,KA5NA;AA6NA;AACAgC,kBA9NA,4BA8NA;AAAA;;AACAC;AACA,6BACA;AACAjC;AACA;;AAEA,+DACA;AAEA;AAEA;AACA;AACA,OAbA;AAcA;AA7OA,GAjEA;AAkTAkC;AACAlC;AACA;AACA;AACA;AAAA;AAAA;AACA,GAvTA;AAwTAmC,SAxTA,qBAwTA;AACAnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhUA","names":["data","imageUrl","dynamicValidateForm","domains","value","email","ruleForm","pass","form","name","region","date1","date2","delivery","type","sex","desc","fileName","item","index","activeTab","selectItem","confirmDelete","confirmPay","confirmPay2","checkAll","isIndeterminate","cart_list","ticket_state","img","film_name","seat","start_time","end_time","state","price","state0","color","state_desc","state1","state2","state3","computed","totalprice","total_price","methods","beforeAvatarUpload","file","handleAvatarSuccess","res","console","onSubmit2","password","avatar","nickname","birthday","gender","info","id","ModifySelf","message","window","ClickDelete","onSubmit","SuccessPay","SimPaySuccess","FailPay","SimPayFail","cilckconfirmPay","HandleDeleteCartItem","DeleteCart","handleClose","done","then","catch","changeStateCSS","changeState","handleCheckAllChange","val","handleCheckedCitiesChange","Add_Cart_List","QueryCart","AddtoOrderList","QueryOrderByUid","beforeCreate","created"],"sourceRoot":"src/views","sources":["personal_center.vue"],"sourcesContent":["<template>\r\n<div class=\"all\">\r\n  <el-tabs type=\"border-card\" tab-position=\"left\" style=\"height:800px\" v-model=\"activeTab\">\r\n      <!-- 购物车 -->\r\n  <el-tab-pane name=\"first\">\r\n    <div slot=\"label\" class=\"tabtag\"><i class=\"el-icon-goods\"></i> 购物车&nbsp;&nbsp;</div>\r\n    <h2>购物车</h2>\r\n    <div style=\"overflow:auto;height:730px\">\r\n    <div class=\"cart_box\" v-for=\"(item,index) in cart_list\" :key=\"index\">\r\n      <!-- 选中框 -->\r\n      <el-checkbox v-model=\"selectItem\" :label=\"index\" style=\"position:relative;top:-80px\" @change=\"handleCheckedCitiesChange\">选中</el-checkbox>\r\n      <!-- 电影海报 -->\r\n      <div class=\"cart_box1\" ><img :src=\"item.film.cover\" /></div>\r\n      <!-- 电影名字座位手机号等信息 -->\r\n       <div class=\"cart_box2\">\r\n         <h3 style=\"padding:0px\">{{item.film.name}}</h3>\r\n         <h5 style=\"padding:0px;margin-top:-5px\">座位：{{item.cart.seats}}</h5>\r\n         <h5>手机：{{item.cart.phone}}</h5>\r\n         <h5>开场时间{{item.arr.date}}&nbsp;{{item.arr.startTime}}</h5>\r\n       </div>\r\n       <!-- 电影价格 -->\r\n<div class=\"cart_box3\" >价格:¥{{item.cart.price}}</div>\r\n<div class=\"cart_box4\" ><el-button type=\"danger\" style=\"width:130px\" @click=\"ClickDelete(item,index)\">删除</el-button></div>\r\n    </div>\r\n    <!-- 购物车页底部 -->\r\n    <div class=\"cart_footer\">\r\n       <div class=\"cart_footer_1\" ><el-checkbox :indeterminate=\"isIndeterminate\" v-model=\"checkAll\" @change=\"handleCheckAllChange\">全选</el-checkbox></div>\r\n       <div class=\"cart_footer_2\"  ><el-button type=\"primary\" style=\"width:130px\" @click=\"cilckconfirmPay()\">全部购买</el-button></div>\r\n       <div class=\"cart_footer_3\" >总价格:¥{{totalprice}}</div>\r\n    </div></div>\r\n  </el-tab-pane>\r\n  <!-- 购物车删除弹框 -->\r\n<el-dialog\r\n  title=\"提示\"\r\n  :visible.sync=\"confirmDelete\"\r\n  width=\"30%\"\r\n  :before-close=\"handleClose\">\r\n  <span>确认删除吗?此操作不可撤销</span>\r\n  <span slot=\"footer\" class=\"dialog-footer\">\r\n    <el-button @click=\"confirmDelete = false\">取 消</el-button>\r\n    <el-button type=\"primary\" @click=\"HandleDeleteCartItem(item,index)\">确定删除</el-button>\r\n  </span>\r\n</el-dialog>\r\n<!-- 结算弹框1 -->\r\n<el-dialog\r\n  title=\"提示\"\r\n  :visible.sync=\"confirmPay\"\r\n  width=\"30%\"\r\n  :before-close=\"handleClose\">\r\n  <span>总价格:¥{{totalprice}}</span>\r\n  <span slot=\"footer\" class=\"dialog-footer\">\r\n    <el-button @click=\"confirmPay = false\">取 消</el-button>\r\n    <el-button type=\"primary\" @click=\"confirmPay = false;confirmPay2 =true\">确定支付</el-button>\r\n  </span>\r\n</el-dialog>\r\n\r\n<!-- 结算弹框2 -->\r\n<el-dialog\r\n  title=\"支付界面\"\r\n  :visible.sync=\"confirmPay2\"\r\n  width=\"30%\"\r\n  :before-close=\"handleClose\">\r\n  <img style=\"width:300px;height:300px;margin:10px 100px\" src=\"../assets/img/QRcode.jpg\" />\r\n  <span slot=\"footer\" class=\"dialog-footer\">\r\n    <el-button @click=\"confirmPay2 = false\">取 消</el-button>\r\n    <el-button type=\"primary\" @click=\"SuccessPay()\">模拟支付成功</el-button>\r\n    <el-button type=\"primary\" @click=\"FailPay()\">模拟支付失败</el-button>\r\n  </span>\r\n</el-dialog>\r\n\r\n<!-- 购物车页结束 -->\r\n\r\n\r\n<!-- 我的订单 -->\r\n  <el-tab-pane name=\"second\">\r\n      <span slot=\"label\" class=\"tabtag\"><i class=\"el-icon-tickets\"></i>订单详情</span>\r\n      <h2>我的订单</h2>\r\n      <div style=\"overflow:auto;height:730px\">\r\n      <div class=\"my_ticket\" v-for=\"(item,index) in ticket_state\" :key=\"index\">\r\n        <div class=\"cart_box1\" ><img :src=\"item.film.cover\" /></div>\r\n      <!-- 我的订单电影名字座位手机号等信息 -->\r\n       <div class=\"cart_box2\">\r\n         <h3 style=\"padding:0px\">{{item.film.name}}</h3>\r\n         <h5 style=\"padding:0px;margin-top:-5px\">订购座位：{{item.order.seats}}</h5>\r\n         <h5>开场时间:{{item.arr.date}}&nbsp;{{item.arr.startTime}}</h5>\r\n         <h5>结束时间:{{item.arr.date}}&nbsp;{{item.arr.endTime}}</h5>\r\n       </div>\r\n       <!-- 我的订单电影价格 -->\r\n<div class=\"cart_box3\" >价格:¥{{item.order.price}}</div>\r\n<div class=\"cart_box4\" ><span class=\"ticket_state_css\" :style=\"changeStateCSS(item)\" >{{changeState(item)}}</span></div>\r\n      </div>\r\n\r\n      </div>\r\n\r\n\r\n\r\n      </el-tab-pane>\r\n\r\n<!-- 基本设置 -->\r\n  <el-tab-pane name=\"third\">\r\n      <span slot=\"label\" class=\"tabtag\"><i class=\"el-icon-setting\"></i>个人设置</span>\r\n       <h2>个人设置</h2>\r\n       <div class=\"set\">\r\n       <div class=\"basic_aside\">\r\n      <el-form ref=\"form\" :model=\"form\" label-width=\"80px\">\r\n        <el-form-item>\r\n          <p style=\"display:inline-block\">昵称</p>\r\n          <el-input v-model=\"form.name\" style=\"display:inline-block\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item prop=\"pass\">\r\n          <p>密码</p>\r\n          <el-input\r\n            type=\"password\"\r\n            v-model=\"ruleForm.pass\"\r\n            autocomplete=\"off\"\r\n          ></el-input>\r\n        </el-form-item>\r\n        <el-form-item>\r\n          <p>性别</p>\r\n          <el-radio-group v-model=\"form.sex\">\r\n            <el-radio label=\"男\"></el-radio>\r\n            <el-radio label=\"女\"></el-radio>\r\n          </el-radio-group>\r\n        </el-form-item>\r\n        <el-form-item>\r\n          <p>出生年月</p>\r\n          <el-col :span=\"11\">\r\n            <el-date-picker\r\n              type=\"date\"\r\n              placeholder=\"选择日期\"\r\n              v-model=\"form.date1\"\r\n              style=\"width: 100%\"\r\n            ></el-date-picker>\r\n          </el-col>\r\n        </el-form-item>\r\n         <el-form :model=\"dynamicValidateForm\" ref=\"dynamicValidateForm\" >\r\n        <el-form-item\r\n          prop=\"email\"\r\n          :rules=\"[\r\n            { required: true, message: '请输入邮箱地址', trigger: 'blur' },\r\n            {\r\n              type: 'email',\r\n              message: '　　　　　　　　请输入正确的邮箱地址',\r\n              trigger: ['blur', 'change'],\r\n            },\r\n          ]\"\r\n        >\r\n          <p style=\"display:block;position:relative;left:80px\">邮箱</p>\r\n          <el-input style=\"display:block;position:relative;left:80px\" v-model=\"dynamicValidateForm.email\"></el-input>\r\n        </el-form-item>\r\n        </el-form>\r\n        <el-form-item>\r\n          <p>个人简介</p>\r\n          <el-input type=\"textarea\" v-model=\"form.desc\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item>\r\n          <el-button type=\"primary\" @click=\"onSubmit2()\">更新基本信息</el-button>\r\n          <el-button>取消</el-button>\r\n        </el-form-item>\r\n      </el-form>\r\n    </div>\r\n      <div class=\"picture\">\r\n      <div><el-upload\r\n\t\t\t\t\t\tclass=\"avatar-uploader\"\r\n            action=\"http://localhost:8081/api/user/upload\"\r\n\t\t\t\t\t\t:show-file-list=\"false\"\r\n\t\t\t\t\t\t:on-success=\"handleAvatarSuccess\"\r\n\t\t\t\t\t\t:before-upload=\"beforeAvatarUpload\">\r\n\t\t\t\t\t\t<img v-if=\"imageUrl\" :src=\"imageUrl\" class=\"avatar\">\r\n\t\t\t\t\t\t<i v-else class=\"el-icon-plus avatar-uploader-icon\"></i>\r\n\t\t\t\t\t</el-upload></div>\r\n      <!-- <el-button type=\"primary\" class=\"btn\">点击上传</el-button> -->\r\n      <p>只能上传jpg/png图片</p>\r\n      <p>不能带有特殊符号</p>\r\n    </div>\r\n       </div>\r\n      </el-tab-pane>\r\n</el-tabs>\r\n</div>\r\n</template>\r\n\r\n<script>\r\nimport{ModifySelf} from \"@/api/user\"\r\nimport{QueryCart,DeleteCart} from \"@/api/cart\";\r\nimport{QueryOrderByUid,SimPaySuccess,SimPayFail} from \"@/api/order\";\r\nimport { parseTime } from \"@/plugins/DateTran\";//日期格式转化\r\nexport default {\r\n     data(){\r\n       return{\r\n         //个人设置信息单\r\n        imageUrl:null,\r\n        dynamicValidateForm:{\r\n        domains: [\r\n          {\r\n            value: null,\r\n          },\r\n        ],\r\n        email: null, //邮箱\r\n      },\r\n      ruleForm: { pass: null }, //密码\r\n      form: {\r\n        name: null, //昵称\r\n        region:null,\r\n        date1: null,//生日\r\n        date2: null,\r\n        delivery: false,\r\n        type: [],\r\n        sex: null,// 性别\r\n        desc: null, //个人介绍\r\n      },\r\n\t\t\tfileName:null,\r\n\r\n         //暂存信息\r\n         item:{},\r\n         index:99,\r\n        //  Tab页的切换显示\r\n        activeTab:this.$store.state.activeTab,\r\n        //  选中框存放序列\r\n         selectItem:[],\r\n         //购物车删除弹框\r\n         confirmDelete:false,\r\n         //确认结算弹框开关\r\n         confirmPay:false,\r\n         confirmPay2:false,\r\n         checkAll: false,\r\n         isIndeterminate: true,\r\n         //购物车\r\n        cart_list:[],\r\n        //订单\r\n        ticket_state:[\r\n          {img:require(\"../assets/filmImg/error.gif\"),film_name:\"狮子王\",seat:30,start_time:\"2022/3/27 12:00\",end_time:\"2022/3/27 12:00\",state:0,price:30},\r\n          {img:require(\"../assets/filmImg/error.gif\"),film_name:\"狮子王\",seat:30,start_time:\"2022/3/27 12:00\",end_time:\"2022/3/27 12:00\",state:1,price:10},\r\n          {img:require(\"../assets/filmImg/error.gif\"),film_name:\"狮子王\",seat:30,start_time:\"2022/3/27 12:00\",end_time:\"2022/3/27 12:00\",state:2,price:50},\r\n          {img:require(\"../assets/filmImg/error.gif\"),film_name:\"狮子王\",seat:30,start_time:\"2022/3/27 12:00\",end_time:\"2022/3/27 12:00\",state:3,price:50}\r\n        ],\r\n        //支付状态\r\n        state0:[{color:\"orange\"},{state_desc:\"等待支付\"}],\r\n        state1:[{color:\"red\"},{state_desc:\"支付失败\"}],\r\n        state2:[{color:\"green\"},{state_desc:\"支付成功\"}],\r\n        state3:[{color:\"blue\"},{state_desc:\"已被撤销\"}],\r\n\r\n       }\r\n     },\r\n     computed:{\r\n       totalprice:function(){\r\n         var total_price=0;\r\n         for(var i=0;i<this.selectItem.length;i++)\r\n         {total_price=total_price+this.cart_list[this.selectItem[i]].cart.price}\r\n         return total_price;\r\n       }\r\n     },\r\n     methods:{\r\n       //个人信息\r\n       beforeAvatarUpload(file) {\r\n\t\t\tconst isJPG = file.type === 'image/jpeg';\r\n      const isPNG = file.type === 'image/png';\r\n\t\t\tconst isLt2M = file.size / 2048 / 2048 < 2;\r\n\r\n\t\t\tif (!isJPG&!isPNG) {\r\n\t\t\t\tthis.$message.error('上传头像图片只能是 JPG 或者 PNG 格式!');\r\n\t\t\t}\r\n\t\t\tif (!isLt2M) {\r\n\t\t\t\tthis.$message.error('上传头像图片大小不能超过 8MB!');\r\n\t\t\t}\r\n\t\t\treturn isPNG&isJPG && isLt2M;\r\n\t\t},\r\n\t\thandleAvatarSuccess(res, file) {\r\n\t\t\tconsole.log(res.data.fileName);\r\n\t\t\tthis.fileName=res.data.fileName;\r\n\t\t\tthis.imageUrl = URL.createObjectURL(file.raw);\r\n\t\t\r\n\t\t},\r\n    onSubmit2() {\r\n\t\t\tlet data={\r\n\t\t\t\tpassword:this.ruleForm.pass,\r\n\t\t\t\tavatar:this.fileName,\r\n\t\t\t\tnickname:this.form.name,\r\n\t\t\t\temail:this.dynamicValidateForm.email,\r\n\t\t\t\tbirthday:this.form.date1,\r\n\t\t\t\tgender:this.form.sex,\r\n\t\t\t\tinfo:this.form.desc,\r\n\t\t\t\tid:localStorage.getItem(\"uid\"),\r\n\t\t\t};\r\n\t\t\tconsole.log(data);\r\n\t\t\t  if(this.ruleForm.pass!=null)\r\n        { if(data.password.length<6)\r\n        {this.$message.error(\"请输入6位以上的密码\")}\r\n        else{\r\n          ModifySelf(data).then((res)=>{\r\n\t\t\t\tif(res.code==200)\r\n        {\r\n          if(res.data.success==\"success\")\r\n          {\r\n            this.$message({message:res.data.msg,type:res.data.success})\r\n            window.location.reload();\r\n          }\r\n          else{\r\n            this.$message.error(\"更新失败\")\r\n          }\r\n        }\r\n        else{\r\n          this.$message.error(\"请求失败\")\r\n        }\r\n\t\t\t});\r\n        }\r\n          }\r\n        else{\r\n          ModifySelf(data).then((res)=>{\r\n\t\t\t\tif(res.code==200)\r\n        {\r\n          if(res.data.success==\"success\")\r\n          {\r\n            this.$message({message:res.data.msg,type:res.data.success})\r\n            window.location.reload();\r\n          }\r\n          else{\r\n            this.$message.error(\"更新失败\")\r\n          }\r\n        }\r\n        else{\r\n          this.$message.error(\"请求失败\")\r\n        }\r\n\t\t\t});\r\n        }\r\n        \r\n        \r\n      \r\n    },\r\n       //删除弹框方法\r\n       ClickDelete(item,index)\r\n       {\r\n         this.item=item;\r\n         this.index=index;\r\n         this.confirmDelete=true;\r\n       },\r\n       onSubmit() {\r\n        console.log('submit!')\r\n     },\r\n     //模拟支付成功\r\n     SuccessPay(){\r\n       for(var i=0;i<this.selectItem.length;i++)\r\n       {\r\n         const vo=this.cart_list[i];\r\n        SimPaySuccess(vo).then((res)=>{\r\n          if(res.code==200)\r\n          {\r\n            if(res.data.success==\"success\"){\r\n                    this.$message({message:res.data.msg,type:\"success\"},)\r\n                   }\r\n                    else{\r\n                 this.$message({message:res.data.msg,type:\"warning\"},)\r\n                     }\r\n          }\r\n          else{\r\n            this.$message.error(\"支付失败\")\r\n          }\r\n          window.location.reload();\r\n        })\r\n        console.log(vo);\r\n       }\r\n       this.confirmPay2 = false;\r\n     },\r\n     //模拟支付失败\r\n     FailPay(){\r\n      for(var i=0;i<this.selectItem.length;i++)\r\n       {\r\n         const vo=this.cart_list[i];\r\n        SimPayFail(vo).then((res)=>{\r\n          if(res.code==200)\r\n          {\r\n            if(res.data.success==\"success\"){\r\n                    this.$message({message:res.data.msg,type:\"success\"},)\r\n                   }\r\n                    else{\r\n                 this.$message({message:res.data.msg,type:\"warning\"},)\r\n                     }\r\n          }\r\n          else{\r\n            this.$message.error(\"支付失败\")\r\n          }\r\n          window.location.reload();\r\n        })\r\n        console.log(vo);\r\n       }\r\n       this.confirmPay2 = false;\r\n     },\r\n     //点击确认支付按钮\r\n     cilckconfirmPay(){\r\n       if(this.totalprice!=0)\r\n       {\r\n       this.confirmPay =true;\r\n       }\r\n       else{\r\n         this.$message({message:\"请先选中一个订单\",type:\"warning\"});\r\n       }\r\n\r\n     },\r\n     //删除按钮\r\n     HandleDeleteCartItem(item,index){\r\n        DeleteCart(item.cart).then((res)=>{\r\n          if(res.code==200){\r\n            this.cart_list.splice(index,1);\r\n          }\r\n          else{\r\n            this.$message.error(\"删除失败\");\r\n          }\r\n        })\r\n        window.location.reload();\r\n     },\r\n     //确认结算弹框\r\n     handleClose(done) {\r\n        this.$confirm('确认关闭？')\r\n          .then(_ => {\r\n            done();\r\n          })\r\n          .catch(_ => {});\r\n      },\r\n      //改变支付状态样式和判断支付样式的方法\r\n      changeStateCSS(item){\r\n        if(item.order.status==0){return this.state0[0]}\r\n        if(item.order.status==1){return this.state1[0]}\r\n        if(item.order.status==2){return this.state2[0]}\r\n        if(item.order.status==3){return this.state3[0]}\r\n      },\r\n      changeState(item){\r\n        if(item.order.status==0){return this.state0[1].state_desc}\r\n        if(item.order.status==1){return this.state1[1].state_desc}\r\n        if(item.order.status==2){return this.state2[1].state_desc}\r\n        if(item.order.status==3){return this.state3[1].state_desc}\r\n      },\r\n      // 按下全选按钮的方法\r\n      handleCheckAllChange(val) {\r\n        if(this.checkAll==true)\r\n        {this.selectItem=undefined;this.selectItem=new Array();\r\n         for(var i=0;i<this.cart_list.length;i++){this.selectItem.push(i)}\r\n        }\r\n        if(this.checkAll==false)\r\n        {this.selectItem=undefined;this.selectItem=new Array();}\r\n        this.isIndeterminate = false;\r\n      },\r\n       // 按下选中按钮的方法\r\n      handleCheckedCitiesChange(value) {\r\n        //重新排序的方法\r\n        var compare=function(x,y){\r\n          if(x<y){return -1}\r\n          else if(x>y){return 1}\r\n          else{return 0}\r\n        }\r\n        this.selectItem=this.selectItem.sort(compare);\r\n        console.log(this.selectItem);\r\n        let checkedCount = value.length;\r\n        this.checkAll = checkedCount === this.selectItem.length;\r\n        this.isIndeterminate = checkedCount > 0 && checkedCount < this.selectItem.length;\r\n        if(this.selectItem.length==this.cart_list.length){this.checkAll=true}\r\n      },\r\n      //购物车接口,输入Cart_List\r\n    Add_Cart_List(){\r\n      QueryCart(   parseInt( localStorage.getItem(\"uid\") )  ).then((res)=>{\r\n        if(res.code==200)\r\n        {\r\n          console.log(\"购物车接口数据\");\r\n         console.log(res);\r\n         this.cart_list=res.data;\r\n         for(var i=0;i<this.cart_list.length;i++)\r\n         {\r\n         \r\n           this.cart_list[i].arr.date=parseTime(new Date(this.cart_list[i].arr.date),\"{y}-{m}-{d}\");\r\n        \r\n         }\r\n        }\r\n      })\r\n  },\r\n      //订单接口，输入 ticket_state\r\n     AddtoOrderList(){\r\n       QueryOrderByUid(parseInt( localStorage.getItem(\"uid\") )).then((res)=>{\r\n         if(res.code==200)\r\n         {\r\n           console.log(\"用户订单接口数据\");\r\n           this.ticket_state=res.data;\r\n          \r\n           for(var i=0;i<this.ticket_state.length;i++)\r\n         {\r\n         \r\n           this.ticket_state[i].arr.date=parseTime(new Date(this.ticket_state[i].arr.date),\"{y}-{m}-{d}\");\r\n        \r\n         }\r\n         }\r\n       })\r\n     },\r\n  \r\n     },\r\n     \r\n     beforeCreate:function(){\r\n\t\t\tconsole.log(\"BeforeCreate\");\r\n            this.$store.state.navnum=0;\r\n            this.$store.state.color3.color=\"#5b5d63\";\r\n            this.$store.state.color1.color=\"#5b5d63\";this.$store.state.color2.color=\"#5b5d63\";this.$store.state.color4.color=\"#5b5d63\";\r\n\t\t},\r\n     created(){\r\n    console.log(\"查询购物车方法QueryCart,获取其中的购物车信息,添加到cart_list,并且清空Cart_list\");\r\n      this.cart_list=undefined;\r\n      this.cart_list=new Array();\r\n      this.ticket_state=undefined;\r\n      this.ticket_state=new Array();\r\n      this.Add_Cart_List();\r\n      this.AddtoOrderList();\r\n  },\r\n     \r\n     \r\n     }\r\n\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.all{width:1400px;overflow:auto;margin:20px auto}\r\n.tabtag{display:block;width:200px;text-align:center;font-size:20px}\r\n/* 购物车页 */\r\n.cart_box{width:1100px;height:180px;margin-top:30px;overflow:hidden;border: 1px solid rgb(187, 187, 187);padding-left: 5px;}\r\n.cart_box1 img{width:140px;height:160px}\r\n.cart_box1{display:inline-block;width:140px;height:160px;margin:10px 40px;overflow:hidden}\r\n.cart_box2{display:inline-block;width:440px;height:160px;margin:10px 10px;overflow:hidden}\r\n.cart_box3{display:inline-block;width:140px;height:160px;line-height:160px;margin:10px 30px;overflow:hidden}\r\n.cart_box4{display:inline-block;width:140px;height:60px;line-height:60px;margin:60px 0px;overflow:hidden}\r\n.cart_footer{width:1100px;height:60px;margin-top:30px;overflow:hidden}\r\n.cart_footer_1{display:inline-block;height:60px;line-height:60px}\r\n.cart_footer_2{display:inline-block;float:right;height:60px;line-height:60px;margin-right:30px}\r\n.cart_footer_3{display:inline-block;height:60px;line-height:60px;float:right;width:180px}\r\n/* 我的订单 */\r\n.my_ticket{\r\n  width:1100px;height:180px;margin-top:30px;overflow:hidden;border: 1px solid rgb(187, 187, 187);\r\n}\r\n.ticket_state_css{width:130px;text-align:center;display:inline-block}\r\n/* 个人设置 */\r\n.my_setting{\r\n  width:1100px;height:700px;margin-top:30px;overflow:hidden;\r\n}\r\n/* 头像设置 */\r\n// .avatar-uploader .el-upload {\r\n//     border: 1px dashed #d9d9d9;\r\n//     border-radius: 6px;\r\n//     cursor: pointer;\r\n//     position: relative;\r\n//     overflow: hidden;\r\n//   }\r\n//   .avatar-uploader .el-upload:hover {\r\n//     border-color: #409EFF;\r\n//   }\r\n//   .avatar-uploader-icon {\r\n//     font-size: 28px;\r\n//     color: #8c939d;\r\n//     width: 178px;\r\n//     height: 178px;\r\n//     line-height: 178px;\r\n//     text-align: center;\r\n//   }\r\n//   .avatar {\r\n//     width: 178px;\r\n//     height: 178px;\r\n//     display: block;\r\n//   }\r\n  .all .el-tabs__item{height:200px !important}\r\n\r\n  .set {\r\n  float: left;\r\n  width: 830px;\r\n  height: 600px;\r\n  overflow: auto;\r\n  //   margin: 0 auto;\r\n//   border: 1px solid rgb(158, 156, 156);\r\ntextarea{\r\n     resize:none;\r\n}\r\n  .basic_aside {\r\n    width: 400px;\r\n    float: left;\r\n    margin: 20px;\r\n    .text {\r\n      font-size: 28px;\r\n      margin-left: 80px;\r\n      height: 80px;\r\n      line-height: 80px;\r\n    }\r\n  }\r\n  .picture {\r\n    float: right;\r\n    margin: 70px;\r\n    div {\r\n      width: 120px;\r\n      height: 120px;\r\n      background: rgb(197, 197, 197);\r\n      //   margin-left: 20px;\r\n    }\r\n    .btn {\r\n      margin-top: 40px;\r\n      width: 120px;\r\n    }\r\n    p {\r\n      height: 50px;\r\n      line-height: 50px;\r\n      text-align: center;\r\n      font-size: 14px;\r\n      color: gray;\r\n    }\r\n  }\r\n}\r\n.avatar-uploader .el-upload {\r\n    border: 1px dashed #d9d9d9;\r\n    border-radius: 6px;\r\n    cursor: pointer;\r\n    position: relative;\r\n    overflow: hidden;\r\n  }\r\n  .avatar-uploader .el-upload:hover {\r\n    border-color: #409EFF;\r\n  }\r\n  .avatar-uploader-icon {\r\n    font-size: 28px;\r\n    color: #8c939d;\r\n    width: 120px;\r\n    height: 120px;\r\n    line-height: 120px;\r\n    text-align: center;\r\n  }\r\n  .avatar {\r\n    width: 120px;\r\n    height: 120px;\r\n    display: block;\r\n  }\r\n</style>"]},"metadata":{},"sourceType":"module"}