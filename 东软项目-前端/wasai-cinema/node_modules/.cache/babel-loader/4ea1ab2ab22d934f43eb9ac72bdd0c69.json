{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { QueryFilmList, QueryFilmArrangement, PostFilmComment } from \"@/api/film\";\nimport { parseTime } from \"@/plugins/DateTran\";\nexport default {\n  data() {\n    return {\n      //初始化评分\n      score: 0,\n      //控制评分框显示\n      rate_visible: false,\n      //控制排片表显示\n      film_visible: true,\n      //控制无排片的显示\n      nofilm_visible: false,\n      //提交评分表单\n      form_comment: {\n        comment: \"\",\n        star: 0,\n        fid: \"\",\n        uid: \"\"\n      },\n      //路由传参FID\n      Film_id: this.$route.query.fid,\n      //电影详情，接口传入数据\n      movie_info: [],\n      //测试用数据\n      testvalue: 3.7,\n      //经过接口之后的表\n      new_film_list: []\n    };\n  },\n\n  methods: {\n    ClickBack() {\n      this.$router.push(\"/film_detail?fid=\" + this.Film_id);\n    },\n\n    //生成一个除以3的缩略星级热度\n    filmstar(n) {\n      this.score = this.movie_info.hot / n;\n    },\n\n    //点击购票之后的跳转\n    buy_ticket_click(item) {\n      if (this.$store.state.islogin == false) {\n        this.$confirm('未检测到登录', '提示', {\n          confirmButtonText: '去登陆',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(() => {\n          this.$router.push(\"/login\");\n        });\n      } else {\n        this.$store.state.navnum = 1;\n        this.$store.state.color2.color = \"blue\";\n        this.$store.state.color1.color = \"#5b5d63\";\n        this.$store.state.color3.color = \"#5b5d63\";\n        this.$store.state.color4.color = \"#5b5d63\";\n        this.$router.push(\"/seat?id=\" + item.id);\n      }\n    },\n\n    load() {\n      this.count += 2;\n    },\n\n    //电影场次信息(测试用)\n    //  QueryMovieArrangement(){\n    //      QueryFilmArrangement().then((res)=>{\n    //         if(res.code==200){\n    //            for(var i=0;i<res.data.arrangements.length;i++){\n    //           if(this.Film_id==res.data.arrangements[i].fid)\n    //           {this.new_film_list.push(res.data.arrangements[i])}\n    //         };\n    //         if(this.new_film_list.length>=1){this.film_visible=true;this.nofilm_visible=false}\n    //         else if(this.new_film_list.length==0){this.film_visible=false;this.nofilm_visible=true};\n    //         }\n    //     })\n    //  },\n    // 电影场次信息接口\n    QueryMovieArrangement() {\n      QueryFilmArrangement(this.Film_id).then(res => {\n        if (res.code == 200) {\n          console.log(res);\n          this.new_film_list = res.data;\n        }\n\n        ;\n\n        if (this.new_film_list.length >= 1) {\n          this.film_visible = true;\n          this.nofilm_visible = false;\n        } else if (this.new_film_list.length == 0) {\n          this.film_visible = false;\n          this.nofilm_visible = true;\n        }\n\n        ;\n\n        for (var i = 0; i < this.new_film_list.length; i++) {\n          this.new_film_list[i].date = parseTime(new Date(this.new_film_list[i].date), '{y}-{m}-{d}');\n        }\n      });\n    },\n\n    //电影详细信息\n    QueryMovieinfo() {\n      QueryFilmList().then(res => {\n        if (res.code == 200) {\n          for (var i = 0; i < res.data.length; i++) {\n            if (this.Film_id == res.data[i].id) {\n              this.movie_info = res.data[i];\n              this.movie_info.releaseTime = parseTime(new Date(this.movie_info.releaseTime), \"{y}-{m}-{d}\");\n            }\n          }\n        }\n      });\n    },\n\n    //点击评论\n    // ClickPostComment(){\n    //     this.form_comment.fid=this.Film_id;\n    //     this.form_comment.uid=localStorage.getItem(\"uid\");\n    //     const PostComment=this.form_comment;\n    //     PostFilmComment(PostComment).then((res)=>{\n    //         if(res.code==200)\n    //         {\n    //             this.$message({message:\"评论成功\",type:\"success\"},);\n    //             this.rate_visible = false;\n    //             }\n    //         else{\n    //             this.$message({message:\"评论失败\",type:\"warning\"},);\n    //         }\n    //     })\n    // },\n    //查看是否登录\n    isLogin(a) {\n      if (this.$store.state.islogin == false) {\n        this.$confirm('未检测到登录', '提示', {\n          confirmButtonText: '去登陆',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(() => {\n          this.$router.push(\"/login\");\n        });\n      }\n    },\n\n    preload() {\n      console.log(this.new_film_list);\n      this.new_film_list = undefined;\n      this.new_film_list = new Array();\n      console.log(this.new_film_list);\n    }\n\n  },\n  //生命周期函数。用来筛选新排片列表，生成new_film_list\n  created: function () {\n    this.new_film_list = undefined;\n    this.new_film_list = new Array();\n    console.log(\"BeforeTicketCreate\");\n  },\n  updated: function () {\n    //热度星级除以3算法,直接写进computed有BUG\n    this.filmstar(3);\n  },\n  //生命周期函数。用来调用接口\n  mounted: function () {\n    //查询电影列表并添加到movie_info列表\n    this.QueryMovieinfo(); //查询电影列表并添加到new_film_list列表\n\n    this.QueryMovieArrangement(); //查看电影有没有场次\n\n    if (this.new_film_list.length >= 1) {\n      this.film_visible = true;\n      this.nofilm_visible = false;\n    } else if (this.new_film_list.length == 0) {\n      this.film_visible = false;\n      this.nofilm_visible = true;\n    }\n\n    ;\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4EA;AACA;AACA;AACAA;AACA;AACA;AACAC,cAFA;AAGA;AACAC,yBAJA;AAKA;AACAC,wBANA;AAOA;AACAC,2BARA;AASA;AACAC;AAAAC;AAAAC;AAAAC;AAAAC;AAAA,OAVA;AAWA;AACAC,oCAZA;AAaA;AACAC,oBAdA;AAeA;AACAC,oBAhBA;AAiBA;AACAC;AAlBA;AAqBA,GAvBA;;AAwBAC;AACAC;AACA;AACA,KAHA;;AAIA;AACAC;AACA;AACA,KAPA;;AAQA;AACAC;AACA;AACA;AACAC,kCADA;AAEAC,gCAFA;AAGAC;AAHA,WAIAC,IAJA,CAIA;AACA;AACA,SANA;AAMA,OAPA,MAOA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA,KAvBA;;AAwBAC;AACA;AACA,KA1BA;;AA2BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAC;AACAC;AACA;AACAC;AACA;AACA;;AAAA;;AACA,4CACA;AAAA;AAAA;AAAA,SADA,MAEA,oCACA;AAAA;AAAA;AAAA;;AAAA;;AACA;AACA;AACA;AACA,OAZA;AAcA,KAxDA;;AAyDA;AACAC;AACAC;AACA;AACA;AACA;AACA;AACA,sDACA,qCADA,EACA,aADA;AAEA;AACA;AACA;AACA,OAVA;AAWA,KAtEA;;AAuEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAC;AACA;AACA;AACAV,kCADA;AAEAC,gCAFA;AAGAC;AAHA,WAIAC,IAJA,CAIA;AACA;AACA,SANA;AAMA;AACA,KAjGA;;AAkGAQ;AACAJ;AACA;AACA;AACAA;AACA;;AAvGA,GAxBA;AAiIA;AACAK;AACA;AACA;AACAL;AAEA,GAvIA;AAwIAM;AACA;AACA;AACA,GA3IA;AA4IA;AACAC;AACA;AACA,0BAFA,CAGA;;AACA,iCAJA,CAKA;;AACA;AAAA;AAAA;AAAA,WACA;AAAA;AAAA;AAAA;;AAAA;AACA;AArJA","names":["data","score","rate_visible","film_visible","nofilm_visible","form_comment","comment","star","fid","uid","Film_id","movie_info","testvalue","new_film_list","methods","ClickBack","filmstar","buy_ticket_click","confirmButtonText","cancelButtonText","type","then","load","QueryMovieArrangement","QueryFilmArrangement","console","QueryMovieinfo","QueryFilmList","isLogin","preload","created","updated","mounted"],"sourceRoot":"src/views","sources":["ticket.vue"],"sourcesContent":["<template>\r\n  <div class=\"all\">\r\n      <el-container>\r\n          <!-- 上半 -->\r\n          <!-- 上方电影图片及按钮 -->\r\n         <el-header>\r\n             <div class=\"film_info\">\r\n              <img style=\"width: 240px;height:350px;float:left\" :src=\"movie_info.cover\" alt=\"error\"/>\r\n               <div class=\"film_detail_info_box\">\r\n              <h2 class=\"film_detail_name\" style=\"overflow: hidden;\">{{movie_info.name}}</h2>\r\n              <!-- 下面的filmstar是根据热度值HOT除以3来算的，因为超过5不会显示 -->\r\n                        <el-rate v-model=\"score\" disabled  text-color=\"#ff9900\"\r\n                            score-template=\"{value}\" class=\"rate\"></el-rate>\r\n                            <span class=\"star\">{{movie_info.hot}}</span>\r\n              <span class=\"info_text1\">电影类型：&nbsp; {{movie_info.type}}</span>\r\n              <span class=\"info_text1\">地区:&nbsp;{{movie_info.region}}&nbsp;/&nbsp;时长:&nbsp;{{movie_info.duration}} </span>\r\n              <span class=\"info_text1\">上映日期：&nbsp;{{movie_info.releaseTime}} </span>\r\n              <!-- 购票按钮 -->\r\n              \r\n              <el-button class=\"btn\" disabled>特惠购票</el-button>\r\n              <!-- 评分按钮 -->\r\n              <!-- <el-button class=\"btn\" @click=\"rate_visible = true;isLogin()\">评分</el-button> -->\r\n               <el-dialog title=\"电影评分\" :visible.sync=\"rate_visible\" width=\"50%\"  >\r\n               <el-form :model=\"form_comment\">\r\n                   <el-form-item label=\"\" >\r\n                   <el-rate v-model=\"form_comment.comment_rate\" show-score text-color=\"#ff9900\"></el-rate>\r\n                   </el-form-item>\r\n                <el-form-item label=\"\" >\r\n               <el-input v-model=\"form_comment.content\" autocomplete=\"off\" type=\"textarea\" maxlength=\"20\" show-word-limit :autosize=\"{ minRows: 10, maxRows: 10}\"\r\n                 placeholder=\"请输入内容\"></el-input>\r\n               </el-form-item>\r\n               </el-form>\r\n               <span slot=\"footer\" class=\"dialog-footer\">\r\n               <el-button @click=\"rate_visible = false\">取 消</el-button>\r\n               <el-button type=\"primary\" @click=\"ClickPostComment()\">确认提交</el-button>\r\n               </span>\r\n               </el-dialog>\r\n               </div>\r\n             </div>\r\n         </el-header>\r\n         <!-- 上半结束 -->\r\n\r\n         <!-- 间幕不要动 -->\r\n         <el-link icon=\"el-icon-back\"  @click=\"ClickBack()\" :underline=\"false\" class=\"middle_link\" >返回</el-link>\r\n         <!-- 间幕结束 -->\r\n          <h1 style=\"text-align:left;color:black;margin-left:400px\">电影购票</h1>\r\n         <!-- 下半 -->\r\n         <el-main>\r\n              <!-- 剧情简介结束 -->\r\n\r\n             <!-- 电影无排片 -->\r\n             <div v-show=\" nofilm_visible\">\r\n              <span style=\"color:red;font-size:20px\">本片暂时没有场次</span>\r\n             </div>\r\n             <!-- 电影排片 -->\r\n             <div v-show=\"film_visible\">\r\n               <ul class=\"movie_comment_box\" v-infinite-scroll=\"load\" style=\"overflow:auto\" >\r\n                   <li v-for=\"(item,index) in new_film_list\" :key=\"index\">\r\n                       <span class=\"movie_comment_span1\" >{{item.name}}</span>\r\n                        <br/><span class=\"movie_comment_span2\" >{{item.date}}&nbsp;{{item.startTime}}-{{item.endTime}}</span>\r\n                        <br/><span class=\"movietag\">{{item.type}}</span>\r\n                        <el-button class=\"btn\" style=\"float:right;margin-top:-20px\" @click=\"buy_ticket_click(item)\">选座购票</el-button>\r\n                       <span class=\"movie_comment_span3\" >{{item.price}}¥</span>\r\n                      \r\n                   </li>\r\n               </ul>\r\n             </div>\r\n             <!-- 电影排片结束 -->\r\n\r\n         </el-main>\r\n         <!-- 下半结束 -->\r\n      </el-container>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {QueryFilmList,QueryFilmArrangement,PostFilmComment} from \"@/api/film\";\r\nimport { parseTime } from \"@/plugins/DateTran\";\r\nexport default {\r\n    data(){\r\n        return{\r\n            //初始化评分\r\n            score:0,\r\n            //控制评分框显示\r\n            rate_visible:false,\r\n            //控制排片表显示\r\n            film_visible:true,\r\n            //控制无排片的显示\r\n            nofilm_visible:false,\r\n            //提交评分表单\r\n            form_comment:{comment:\"\",star:0,fid:\"\",uid:\"\"},\r\n            //路由传参FID\r\n            Film_id:this.$route.query.fid,\r\n            //电影详情，接口传入数据\r\n            movie_info:[],\r\n            //测试用数据\r\n            testvalue: 3.7,\r\n            //经过接口之后的表\r\n            new_film_list:[]\r\n\r\n        }\r\n    },\r\n    methods: {\r\n        ClickBack(){\r\n            this.$router.push(\"/film_detail?fid=\" + this.Film_id);\r\n        },\r\n        //生成一个除以3的缩略星级热度\r\n        filmstar(n){\r\n            this.score=this.movie_info.hot/n;\r\n        },\r\n        //点击购票之后的跳转\r\n        buy_ticket_click(item){\r\n            if(this.$store.state.islogin==false){\r\n        this.$confirm('未检测到登录', '提示', {\r\n          confirmButtonText: '去登陆',\r\n          cancelButtonText: '取消',\r\n          type: 'warning'\r\n        }).then(() => {\r\n          this.$router.push(\"/login\");\r\n        });}else{\r\n             this.$store.state.navnum=1;\r\n      this.$store.state.color2.color=\"blue\";\r\n            this.$store.state.color1.color=\"#5b5d63\";this.$store.state.color3.color=\"#5b5d63\";this.$store.state.color4.color=\"#5b5d63\";\r\n            this.$router.push(\"/seat?id=\"+item.id);\r\n        }\r\n        },\r\n      load () {\r\n        this.count += 2\r\n      },\r\n         //电影场次信息(测试用)\r\n        //  QueryMovieArrangement(){\r\n        //      QueryFilmArrangement().then((res)=>{\r\n        //         if(res.code==200){\r\n        //            for(var i=0;i<res.data.arrangements.length;i++){\r\n        //           if(this.Film_id==res.data.arrangements[i].fid)\r\n        //           {this.new_film_list.push(res.data.arrangements[i])}\r\n        //         };\r\n        //         if(this.new_film_list.length>=1){this.film_visible=true;this.nofilm_visible=false}\r\n        //         else if(this.new_film_list.length==0){this.film_visible=false;this.nofilm_visible=true};\r\n        //         }\r\n        //     })\r\n        //  },\r\n        // 电影场次信息接口\r\n         QueryMovieArrangement(){\r\n             QueryFilmArrangement(this.Film_id).then((res)=>{\r\n                if(res.code==200){\r\n                    console.log(res);\r\n                   this.new_film_list=res.data;\r\n                };\r\n                if(this.new_film_list.length>=1)\r\n                {this.film_visible=true;this.nofilm_visible=false}\r\n                else if(this.new_film_list.length==0)\r\n                {this.film_visible=false;this.nofilm_visible=true};\r\n                for(var i=0;i<this.new_film_list.length;i++){\r\n                    this.new_film_list[i].date=parseTime(new Date(this.new_film_list[i].date),'{y}-{m}-{d}')\r\n                }\r\n                }\r\n                \r\n            )},\r\n        //电影详细信息\r\n        QueryMovieinfo(){\r\n            QueryFilmList().then((res)=>{\r\n                if(res.code==200){\r\n                   for(var i=0;i<res.data.length;i++){\r\n                  if(this.Film_id==res.data[i].id) { \r\n                      this.movie_info = res.data[i];\r\n                      this.movie_info.releaseTime = parseTime(\r\n                      new Date(this.movie_info.releaseTime),\"{y}-{m}-{d}\");\r\n                      }\r\n                }\r\n                }\r\n            })\r\n        },\r\n       //点击评论\r\n        // ClickPostComment(){\r\n        //     this.form_comment.fid=this.Film_id;\r\n        //     this.form_comment.uid=localStorage.getItem(\"uid\");\r\n        //     const PostComment=this.form_comment;\r\n        //     PostFilmComment(PostComment).then((res)=>{\r\n        //         if(res.code==200)\r\n        //         {\r\n        //             this.$message({message:\"评论成功\",type:\"success\"},);\r\n        //             this.rate_visible = false;\r\n        //             }\r\n        //         else{\r\n        //             this.$message({message:\"评论失败\",type:\"warning\"},);\r\n        //         }\r\n        //     })\r\n        // },\r\n        //查看是否登录\r\n      isLogin(a) {\r\n        if(this.$store.state.islogin==false){\r\n        this.$confirm('未检测到登录', '提示', {\r\n          confirmButtonText: '去登陆',\r\n          cancelButtonText: '取消',\r\n          type: 'warning'\r\n        }).then(() => {\r\n          this.$router.push(\"/login\");\r\n        });}\r\n        },\r\n        preload(){\r\n            console.log(this.new_film_list);\r\n            this.new_film_list=undefined;\r\n            this.new_film_list = new Array();\r\n            console.log(this.new_film_list);\r\n        }\r\n    },\r\n    //生命周期函数。用来筛选新排片列表，生成new_film_list\r\n            created:function(){\r\n            this.new_film_list=undefined;\r\n            this.new_film_list = new Array();\r\n\t\t\tconsole.log(\"BeforeTicketCreate\");  \r\n              \r\n\t\t},\r\n        updated:function(){\r\n        //热度星级除以3算法,直接写进computed有BUG\r\n        this.filmstar(3);\r\n    },\r\n        //生命周期函数。用来调用接口\r\n        mounted:function(){\r\n        //查询电影列表并添加到movie_info列表\r\n        this.QueryMovieinfo();\r\n        //查询电影列表并添加到new_film_list列表\r\n        this.QueryMovieArrangement();\r\n        //查看电影有没有场次\r\n        if(this.new_film_list.length>=1){this.film_visible=true;this.nofilm_visible=false}\r\n        else if(this.new_film_list.length==0){this.film_visible=false;this.nofilm_visible=true};\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n/* 全局及header和main设置 */\r\n.all{\r\n    width:100%;\r\n    height:100%;\r\n    text-align: center;\r\n}\r\n.el-header{\r\n    background-color: rgb(78, 89, 241);\r\n    color: honeydew;\r\n    min-height:100px;\r\n    width:1400px;\r\n    margin: 0 auto;\r\n    max-height: 350px;\r\n    min-height: 350px;\r\n}\r\n.el-main{\r\n    margin: 0 auto;\r\n    /* background-color: blueviolet; */\r\n    color: honeydew;\r\n    width:1100px;\r\n    max-height:400px;\r\n    min-height:400px;\r\n    overflow:auto\r\n}\r\n/* 上方电影图片及按钮CSS */\r\n.film_info{\r\n    width:1100px;\r\n    height:400px;\r\n    /* background-color: rgb(90, 155, 117); */\r\n    position: relative;\r\n    margin: 50px auto;\r\n}\r\n.film_detail_name{\r\n    display: inline-block;\r\n    float:left;\r\n    font-size:30px;\r\n    color:white;\r\n    width:300px;\r\n    /* background-color: brown; */\r\n    text-align: left;\r\n    height: 143px;\r\n    line-height: 50px;\r\n    margin: -3px;\r\n\r\n}\r\n.film_detail_info_box{\r\n    float:left;margin-left:60px;position:relative;\r\n    /* background-color: blue; */\r\n    height: 400px;\r\n    width:500px;\r\n    }\r\n    .star{\r\n    position:absolute;top:40px;\r\n    color: rgb(255, 136, 0);\r\n}\r\n.rate{\r\n    display: inline-block;\r\n    /* background-color: aqua; */\r\n    height: 100px;\r\n    margin-top:40px ;\r\n    width: 200px;\r\n    text-align: left;\r\n}\r\n.info_text1{\r\n    height: 30px;\r\n    line-height: 30px;\r\n    /* background-color: aqua; */\r\n    display: block;\r\n    text-align: left;\r\n}\r\n.btn{\r\n    margin-top:15px;\r\n    background-color: rgb(243, 77, 77);\r\n    border: none;\r\n    color: white;\r\n    float: left;\r\n    width: 100px;\r\n    margin-right: 20px;\r\n    font-size: 13px;\r\n}\r\n.el-rate__text{\r\n    margin-top:-5px !important ;\r\n}\r\n/* 电影排片CSS */\r\n .movie_comment_box{\r\n    list-style-type: none;\r\n    margin: 0;\r\n    padding:0;\r\n     /* background-color: blue;  */\r\n} \r\n\r\n.movie_comment_box li{\r\n    text-align: left;\r\n    height:80px;\r\n     /* background-color: brown;  */\r\n    margin-bottom: 20px;}\r\n.movie_comment_box li img{\r\n    width:60px;height:60px;border:1px solid gray;border-radius:60px;\r\n}\r\n.movietag{\r\n    float:left;color:blue;border:1px solid lightblue;width:60px;text-align:center;border-radius: 20px;\r\n}\r\n.movie_comment_span1{display:inline-block;float:left;color:black;width:450px}\r\n.movie_comment_span2{float:left;color:gray}\r\n.movie_comment_span3{margin-top:-15px;font-size:20px;margin-right:50px;color:orange;float:right}\r\n/* 间幕 */\r\n.middle_link{margin-bottom:10px;display:block;font-size:16px;width:100px;margin-left:350px;margin-top:60px}\r\n</style>"]},"metadata":{},"sourceType":"module"}