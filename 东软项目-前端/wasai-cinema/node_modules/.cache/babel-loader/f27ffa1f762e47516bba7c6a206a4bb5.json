{"ast":null,"code":"\"use strict\";\n\nvar _createForOfIteratorHelper = require(\"E:/DW/wasai-cinema/node_modules/@babel/runtime/helpers/createForOfIteratorHelper.js\").default;\n\nvar _slicedToArray = require(\"E:/DW/wasai-cinema/node_modules/@babel/runtime/helpers/slicedToArray.js\").default;\n\nvar _taggedTemplateLiteral = require(\"E:/DW/wasai-cinema/node_modules/@babel/runtime/helpers/taggedTemplateLiteral.js\").default;\n\nvar _templateObject, _templateObject2, _templateObject3;\n\nrequire(\"core-js/modules/es.object.keys.js\");\n\nrequire(\"core-js/modules/es.array.join.js\");\n\nrequire(\"core-js/modules/es.function.name.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.validateSchemaDeps = exports.validatePropertyDeps = exports.error = void 0;\n\nvar codegen_1 = require(\"../../compile/codegen\");\n\nvar util_1 = require(\"../../compile/util\");\n\nvar code_1 = require(\"../code\");\n\nexports.error = {\n  message: function message(_ref) {\n    var _ref$params = _ref.params,\n        property = _ref$params.property,\n        depsCount = _ref$params.depsCount,\n        deps = _ref$params.deps;\n    var property_ies = depsCount === 1 ? \"property\" : \"properties\";\n    return (0, codegen_1.str)(_templateObject || (_templateObject = _taggedTemplateLiteral([\"must have \", \" \", \" when property \", \" is present\"])), property_ies, deps, property);\n  },\n  params: function params(_ref2) {\n    var _ref2$params = _ref2.params,\n        property = _ref2$params.property,\n        depsCount = _ref2$params.depsCount,\n        deps = _ref2$params.deps,\n        missingProperty = _ref2$params.missingProperty;\n    return (0, codegen_1._)(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"{property: \", \",\\n    missingProperty: \", \",\\n    depsCount: \", \",\\n    deps: \", \"}\"])), property, missingProperty, depsCount, deps);\n  } // TODO change to reference\n\n};\nvar def = {\n  keyword: \"dependencies\",\n  type: \"object\",\n  schemaType: \"object\",\n  error: exports.error,\n  code: function code(cxt) {\n    var _splitDependencies = splitDependencies(cxt),\n        _splitDependencies2 = _slicedToArray(_splitDependencies, 2),\n        propDeps = _splitDependencies2[0],\n        schDeps = _splitDependencies2[1];\n\n    validatePropertyDeps(cxt, propDeps);\n    validateSchemaDeps(cxt, schDeps);\n  }\n};\n\nfunction splitDependencies(_ref3) {\n  var schema = _ref3.schema;\n  var propertyDeps = {};\n  var schemaDeps = {};\n\n  for (var key in schema) {\n    if (key === \"__proto__\") continue;\n    var deps = Array.isArray(schema[key]) ? propertyDeps : schemaDeps;\n    deps[key] = schema[key];\n  }\n\n  return [propertyDeps, schemaDeps];\n}\n\nfunction validatePropertyDeps(cxt) {\n  var propertyDeps = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : cxt.schema;\n  var gen = cxt.gen,\n      data = cxt.data,\n      it = cxt.it;\n  if (Object.keys(propertyDeps).length === 0) return;\n  var missing = gen.let(\"missing\");\n\n  var _loop = function _loop(prop) {\n    var deps = propertyDeps[prop];\n    if (deps.length === 0) return \"continue\";\n    var hasProperty = (0, code_1.propertyInData)(gen, data, prop, it.opts.ownProperties);\n    cxt.setParams({\n      property: prop,\n      depsCount: deps.length,\n      deps: deps.join(\", \")\n    });\n\n    if (it.allErrors) {\n      gen.if(hasProperty, function () {\n        var _iterator = _createForOfIteratorHelper(deps),\n            _step;\n\n        try {\n          for (_iterator.s(); !(_step = _iterator.n()).done;) {\n            var depProp = _step.value;\n            (0, code_1.checkReportMissingProp)(cxt, depProp);\n          }\n        } catch (err) {\n          _iterator.e(err);\n        } finally {\n          _iterator.f();\n        }\n      });\n    } else {\n      gen.if((0, codegen_1._)(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"\", \" && (\", \")\"])), hasProperty, (0, code_1.checkMissingProp)(cxt, deps, missing)));\n      (0, code_1.reportMissingProp)(cxt, missing);\n      gen.else();\n    }\n  };\n\n  for (var prop in propertyDeps) {\n    var _ret = _loop(prop);\n\n    if (_ret === \"continue\") continue;\n  }\n}\n\nexports.validatePropertyDeps = validatePropertyDeps;\n\nfunction validateSchemaDeps(cxt) {\n  var schemaDeps = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : cxt.schema;\n  var gen = cxt.gen,\n      data = cxt.data,\n      keyword = cxt.keyword,\n      it = cxt.it;\n  var valid = gen.name(\"valid\");\n\n  var _loop2 = function _loop2(prop) {\n    if ((0, util_1.alwaysValidSchema)(it, schemaDeps[prop])) return \"continue\";\n    gen.if((0, code_1.propertyInData)(gen, data, prop, it.opts.ownProperties), function () {\n      var schCxt = cxt.subschema({\n        keyword: keyword,\n        schemaProp: prop\n      }, valid);\n      cxt.mergeValidEvaluated(schCxt, valid);\n    }, function () {\n      return gen.var(valid, true);\n    } // TODO var\n    );\n    cxt.ok(valid);\n  };\n\n  for (var prop in schemaDeps) {\n    var _ret2 = _loop2(prop);\n\n    if (_ret2 === \"continue\") continue;\n  }\n}\n\nexports.validateSchemaDeps = validateSchemaDeps;\nexports.default = def;","map":{"version":3,"mappings":"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","names":["exports","message","params","property","depsCount","deps","property_ies","missingProperty","def","keyword","type","schemaType","error","code","cxt","splitDependencies","propDeps","schDeps","validatePropertyDeps","validateSchemaDeps","schema","propertyDeps","schemaDeps","key","Array","isArray","gen","data","it","Object","keys","length","missing","let","prop","hasProperty","opts","ownProperties","setParams","join","allErrors","if","depProp","else","valid","name","schCxt","subschema","schemaProp","mergeValidEvaluated","var","ok"],"sourceRoot":"","sources":["../../../lib/vocabularies/applicator/dependencies.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}